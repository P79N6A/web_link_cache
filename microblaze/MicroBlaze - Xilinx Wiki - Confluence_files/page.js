(window.webpackJsonp=window.webpackJsonp||[]).push([[225],{CzLb:function(e,t,n){"use strict";n.r(t);var o=n("uDfI"),r=n("SMqo"),i=(n("aWzz"),n("ERkP")),a=n.n(i),s=n("Jygk"),c=n.n(s),l=n("IGvV"),u=n("aKlp"),p=n.n(u),f=n("Bcqe"),d=n.n(f),m=n("Xzcx"),h=n("jqY8");function y(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var b,g=3e4,v=6e4,w=2*v,_=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=p()({min:g,max:v,inactivity:w},n),this._callback=t,this._timer=null,this._lastSeenTimestamp=null,this._setActivityTrigger()}return function(e,t,n){t&&y(e.prototype,t),n&&y(e,n)}(e,[{key:"_setActivityTrigger",value:function(){var e=this;Object(m.a)("visibilitychange",function(){Object(m.c)().hidden?c.a.clearTimeout(e._timer):e._setActive()}),Object(h.c)().addEventListener("focus",this._setActive),Object(m.a)("click",this._setActive),Object(m.a)("scroll",d()(this._setActive,500))}},{key:"_setActive",value:function(){if(this._timer){var e=this._timeSinceLastSeen()>this.options.inactivity;this._lastSeenTimestamp=this._now(),this.start(e)}}},{key:"_now",value:function(){return(new Date).getTime()}},{key:"_timeSinceLastSeen",value:function(){return this._now()+1-this._lastSeenTimestamp}},{key:"_clamp",value:function(e,t,n){var o=Math.max(Math.min(t,n),e);return isNaN(o)?e:o}},{key:"_intervalMultiplier",value:function(){var e=(Object(m.c)().hidden?3:1)*Math.ceil(this._timeSinceLastSeen()/this.options.inactivity);return this._clamp(1,this.options.max/this.options.min,e)}},{key:"start",value:function(e){var t=this;this._lastSeenTimestamp=this._now(),this.stop(),e&&this._callback();var n=function(){t._callback(),o()},o=function(){t.stop(),t._timer=c.a.setTimeout(n,t.options.min*t._intervalMultiplier())};o()}},{key:"stop",value:function(){this._timer&&(c.a.clearTimeout(this._timer),this._timer=null)}}]),e}(),k=n("Q/r/"),C=n("TTdN"),O=n.n(C),q=n("lr0P"),j=n.n(q),E=n("L21V"),x=n("sbiO"),S=n("zQXw"),U=n("kSEI");function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(){return(P=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function F(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var I=Object(E.h)(b=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?N(e):t}(this,R(t).call(this,e)))._onShowFlag=n._onShowFlag.bind(N(N(n))),n._onCloseFlag=n._onCloseFlag.bind(N(N(n))),n._getLatestUpdate=n._getLatestUpdate.bind(N(N(n))),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(t,i["Component"]),function(e,t,n){t&&F(e.prototype,t),n&&F(e,n)}(t,[{key:"_onShowFlag",value:function(e){this.flagEl=e,this._toggleBindClickEventForReloadLink(e,!0)}},{key:"_onCloseFlag",value:function(e){this._toggleBindClickEventForReloadLink(this.flagEl,!1),e||this.props.resetQuickReload()}},{key:"_toggleBindClickEventForReloadLink",value:function(e,t){var n=e&&e.querySelector(".qr-notice-show");n&&(t?n.addEventListener("click",this._getLatestUpdate):n.removeEventListener("click",this._getLatestUpdate))}},{key:"_getLatestUpdate",value:function(){this.props.refreshContent()}},{key:"_buildFlagBodyMarkup",value:function(){var e=this.props,t=e.users,n=e.intl.formatMessage,o=t.slice(0,8),r=Object(S.a)(o,0),i=Object(S.d)(o),s="";2===i?s=n({id:"quick.reload.edit.one.more"}):i>2&&(s=n({id:"quick.reload.edit.more"},[i-1]));var c=o.map(function(e){return a.a.createElement("span",{className:"qr-author-avatar",key:e.userName},a.a.createElement(O.a,{src:e.avatarUrl,size:"small"}))});return a.a.createElement("div",null,a.a.createElement("div",{className:"qr-notice-authors"},c),a.a.createElement("div",{className:"qr-notice-summary"},a.a.createElement(j.a,{type:"link",className:"qr-notice-show aui-button-text"},n({id:"quick.reload.reload"})),a.a.createElement("span",{className:"qr-notice-summary-text"},n({id:"quick.reload.edit.by"})," ",a.a.createElement("a",{href:"".concat(x.b,"/display/~").concat(r.userName),className:"url fn"},r.fullName)," ",a.a.createElement("span",{className:"qr-who-edit"},s))))}},{key:"render",value:function(){var e=this.props,t=e.updatesCount,n=e.users,o=e.intl.formatMessage,r=e.flagDefaultProps,i=e.manyUpdatesTitleI18nKey,s=e.singleUpdateTitleI18nKey;if(Object(S.c)(n))return null;var c=o({id:t>1?i:s},[t]),l=Object(k.renderToStaticMarkup)(this._buildFlagBodyMarkup());return a.a.createElement(U.a,P({isShowing:!0,title:c,body:l,onClose:this._onCloseFlag,onShow:this._onShowFlag},r))}}]),t}())||b;I.displayName="QuickReloadPageFlag";var Q,D,M,A=n("tPAe"),K=n.n(A);function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function V(e,t){return(V=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function W(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var G=Object(l.a)(K.a)((M=D=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return X(W(W(n=function(e,t){return!t||"object"!==z(t)&&"function"!=typeof t?W(e):t}(this,(e=J(t)).call.apply(e,[this].concat(r))))),"lastFetchTime",Date.now()),X(W(W(n)),"_timer",null),X(W(W(n)),"_update",function(){n.props.isNetworkConnected&&(n.props.getQuickReloadUpdates(n.props.contentId,n.lastFetchTime),n.lastFetchTime=Date.now())}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&V(e,t)}(t,i["Component"]),function(e,t,n){t&&B(e.prototype,t),n&&B(e,n)}(t,[{key:"componentDidMount",value:function(){this._timer=new _(this._update),this._timer.start(),this.lastFetchTime=Date.now()}},{key:"componentDidUpdate",value:function(e){this.props.blackListedError&&(console.warn("Quick comment reload plugin has been disabled in this page due to a server error: ",this.props.blackListedError,". Please refresh the page to get it back."),this._timer.stop()),this.props.contentId&&this.props.contentId!==e.contentId&&(this.lastFetchTime=Date.now())}},{key:"componentWillUnmount",value:function(){this._timer.stop()}},{key:"_reloadComments",value:function(){c.a.location.reload()}},{key:"render",value:function(){var e=this.props,t=e.newPageUpdatedUsers,n=e.refreshContent,o=e.resetQuickReloadEdits,r=e.editUpdatesCount,i=e.newCommentUsers,s=e.commentUpdatesCount,c=e.resetQuickReloadComments,l={close:"manual",type:"info",extraClasses:"qr-flag",fifo:!0,stack:"quickreload"};return a.a.createElement(a.a.Fragment,null,a.a.createElement(I,{users:t,refreshContent:n,resetQuickReload:o,flagDefaultProps:l,updatesCount:r,manyUpdatesTitleI18nKey:"quick.reload.edits",singleUpdateTitleI18nKey:"quick.reload.edit"}),a.a.createElement(I,{users:i,refreshContent:this._reloadComments,resetQuickReload:c,flagDefaultProps:l,updatesCount:s,manyUpdatesTitleI18nKey:"quick.reload.newcomments",singleUpdateTitleI18nKey:"quick.reload.newpagecomment"}))}}]),t}(),X(D,"defaultProps",{editUpdatesCount:0,commentUpdatesCount:0}),Q=M))||Q,Y=n("hqKg"),H=Object(Y.createSelector)([function(e){return e},function(e,t){return t}],function(e,t){return e.filter(function(e){return e.userName!==t})});t.default=Object(o.connect)(function(e){var t=e.views.viewPage.quickReload;return{newPageUpdatedUsers:t.get("newPageUpdatedUsers"),newCommentUsers:H(t.get("newCommentUsers"),e.meta.get("remote-user")),blackListedError:t.get("blackListedError"),editUpdatesCount:t.get("editUpdatesCount"),commentUpdatesCount:t.get("commentUpdatesCount"),isNetworkConnected:e.session.errors.get("isNetworkConnected")}},function(e){return{getQuickReloadUpdates:function(t,n){return e(Object(r.a)({contentId:t,lastFetchTime:n}))},refreshContent:function(){return e(Object(r.c)())},resetQuickReloadEdits:function(){return e(Object(r.e)())},resetQuickReloadComments:function(){return e(Object(r.d)())}}})(G)},RRuF:function(e,t,n){(e.exports=n("RDo7")(!1)).push([e.i,".qr-flag .qr-author-avatar{margin-right:5px;vertical-align:middle}.qr-flag .qr-notice-authors{padding:5px 0;max-width:300px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.qr-flag .qr-notice-summary{width:317px}.qr-flag .qr-notice-text{line-height:24px}.qr-flag .qr-notice-summary-text{font-size:12px;color:#707070;display:block;width:217px;max-width:217px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.qr-flag .qr-notice-summary-text a{color:#707070}.qr-flag .qr-notice-show{float:right;max-width:100px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.qr-flag .aui-message{padding-top:10px;padding-bottom:10px}.qr-flag .aui-message.closeable .icon-close{top:10px}",""])},tPAe:function(e,t,n){var o=n("RRuF"),r=n("7l8p");"string"==typeof o&&(o=[[e.i,o,""]]),e.exports=o.locals||{},e.exports._getContent=function(){return o},e.exports._getCss=function(){return o.toString()},e.exports._insertCss=function(e){return r(o,e)}}}]);
//# sourceMappingURL=page.quick-reload.e659dade4c21c12803e9-v35.js.map