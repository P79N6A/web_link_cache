(window.webpackJsonp=window.webpackJsonp||[]).push([[572],{dBMn:function(t,e,n){"use strict";n.r(e);var r=n("sbiO"),o=n("bfgX"),i=n("Jygk"),u=n.n(i);function a(t){var e=Date.now();return function(t){return t.filter(function(t){var e=null;return c(t.name)?c(t.properties)&&t.properties.constructor!==Object&&(e="properties must be an object with key value pairs."):e="you must provide a name for the event.",null===e||(console.log("WARN: Invalid analytics event detected and ignored, ".concat(e,"\nEvent: ").concat(JSON.stringify(t))),!1)})}(t).map(function(t,n,r){var o;return o=t.time>0?t.time-e:n-r.length,{name:t.name,properties:function(t){if(!t)return null;for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];c(n)&&s(n)||(c(n)&&n.toString?t[e]=n.toString():t[e]="")}return t}(t.properties),timeDelta:o}})}function c(t){return void 0!==t&&null!==t}function s(t){return"number"==typeof t||"string"==typeof t||"boolean"==typeof t}var f,l={},d=window,v=d.document,h="localStorage",m="globalStorage";if(l.disabled=!1,l.set=function(t,e){},l.get=function(t){},l.remove=function(t){},l.clear=function(){},l.transact=function(t,e){var n=l.get(t);void 0===n&&(n={}),e(n),l.set(t,n)},l.serialize=function(t){return JSON.stringify(t)},l.deserialize=function(t){if("string"==typeof t)return JSON.parse(t)},function(){try{return h in d&&d[h]}catch(t){return!1}}())f=d[h],l.set=function(t,e){if(void 0===e)return l.remove(t);f.setItem(t,l.serialize(e))},l.get=function(t){return l.deserialize(f.getItem(t))},l.remove=function(t){f.removeItem(t)},l.clear=function(){f.clear()};else if(function(){try{return m in d&&d[m]&&d[m][d.location.hostname]}catch(t){return!1}}())f=d[m][d.location.hostname],l.set=function(t,e){if(void 0===e)return l.remove(t);f[t]=l.serialize(e)},l.get=function(t){return l.deserialize(f[t]&&f[t].value)},l.remove=function(t){delete f[t]},l.clear=function(){for(var t in f)delete f[t]};else if(v.documentElement.addBehavior){var p,y,b=function(t){return function(){var e=Array.prototype.slice.call(arguments,0);e.unshift(f),p.appendChild(f),f.addBehavior("#default#userData"),f.load(h);var n=t.apply(l,e);return p.removeChild(f),n}};try{(y=new ActiveXObject("htmlfile")).open(),y.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></frame>'),y.close(),p=y.w.frames[0].document,f=p.createElement("div")}catch(t){f=v.createElement("div"),p=v.body}l.set=b(function(t,e,n){if(void 0===n)return l.remove(e);t.setAttribute(e,l.serialize(n)),t.save(h)}),l.get=b(function(t,e){return l.deserialize(t.getAttribute(e))}),l.remove=b(function(t,e){t.removeAttribute(e),t.save(h)}),l.clear=b(function(t){var e=t.XMLDocument.documentElement.attributes;t.load(h);for(var n,r=0;n=e[r];r++)t.removeAttribute(n.name);t.save(h)})}try{l.set("__storejs__","__storejs__"),"__storejs__"!=l.get("__storejs__")&&(l.disabled=!0),l.remove("__storejs__")}catch(t){l.disabled=!0}var g=l;function _(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function E(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function S(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var w=new(function(){function t(e){var n=this,r=e.contextPath,o=e.product,i=e.eventEmitter;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),S(this,"_retryCount",0),S(this,"_scheduledPublish",null),S(this,"_events",[]),S(this,"listen",function(){n._eventEmitter.bind("analytics",n._pushEventFromEmitter),n._eventEmitter.bind("analyticsEvent",n._pushEventFromEmitter),u.a.addEventListener("unload",n._addEventsToStore);var t=n._getEventsFromStore();g.remove(n._storageKey),t.length&&(n._addEvents(t),n._debouncedPublish())}),S(this,"push",function(t){n._addEvents([t]),n._debouncedPublish()}),S(this,"_pushEventFromEmitter",function(t,e){n.push({name:e.name,properties:e.data})}),S(this,"_addEventsToStore",function(){var t=n._getEventsFromStore();g.set(n._storageKey,t.concat(n._events))}),!o)throw new Error("You must provide a product when constructing an AnalyticsClient.");this._contextPath=r||"",this._eventEmitter=i,this._storageKey="atlassian-analytics.".concat(o)}return function(t,e,n){e&&E(t.prototype,e),n&&E(t,n)}(t,[{key:"_getEventsFromStore",value:function(){var t=g.get(this._storageKey);return Array.isArray(t)?t:[]}},{key:"_addEvents",value:function(t){var e=this;t.forEach(function(t){e._events.push({name:t.name,properties:t.properties,time:t.time||Date.now()})})}},{key:"_removeEvents",value:function(t){this._events=this._events.slice(t.length)}},{key:"_debouncedPublish",value:function(){var t=this;null===this._scheduledPublish&&(this._scheduledPublish=u.a.setTimeout(function(){return t._bulkPublish().then(function(e){t._scheduledPublish=null,t._retryCount=e?0:t._retryCount+1,t._events.length&&t._debouncedPublish()})},function(t){return Math.min(5e3*Math.pow(2,t),3e5)}(this._retryCount)))}},{key:"_bulkPublish",value:function(){var t=this,e=_(this._events),n=a(e);if(!n.length)return this._events.length=0,Promise.resolve(!0);var r=u.a.document.querySelector("meta[name=atlassian-token]");return u.a.fetch("".concat(this._contextPath,"/rest/analytics/1.0/publish/bulk"),{credentials:"include",headers:{atl_token:r?r.content:"","content-type":"application/json"},method:"POST",body:JSON.stringify(n)}).catch(function(){return{ok:!1}}).then(function(n){return n.ok&&t._removeEvents(e),n.ok})}}]),t}())({contextPath:r.b,product:"confluence",eventEmitter:{bind:o.a}});var k=function(t){return!0===t.isInitial?function(){return new Promise(function(t,e){var n=u.a.document.getElementById("confluence-server-performance");if(null===n)e();else try{t(JSON.parse(n.innerHTML))}catch(t){e()}})}().then(function(t){return t},function(){return{}}):{serverDuration:0}},j=n("r+Ch");function O(t){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var P,A=[],T=[];var C=function(t){var e={};A.forEach(function(n){var r=n(t);"object"===O(r)&&function(t,e){Object.keys(e).forEach(function(n){t[n]=e[n]})}(e,r)});var n={name:"browser.metrics.navigation",properties:e};P.push(n)},I=function(t){var e={};return Object.keys(t).forEach(function(n){var r=t[n];"number"!=typeof r&&"boolean"!=typeof r&&"string"!=typeof r&&null!==r||(e[n]=r)}),e};var L=function(t){if(function(t){return"number"==typeof t.apdex}(t))return{apdex:"".concat(t.apdex)}},J=function(t){return"".concat(Math.floor(t))};var M=function(t){if(function(t){return"number"==typeof t.firstPaint}(t))return{firstPaint:J(t.firstPaint)}};var D=function(t){if(function(t){return"boolean"==typeof t.isInitial}(t))return{isInitial:"".concat(t.isInitial)}};var F=function(t){if(function(t){return"string"==typeof t.journeyId}(t))return{journeyId:t.journeyId}};var N=function(t){if(function(t){return"string"==typeof t.key}(t))return{key:t.key}};var x=function(t){if(function(t){return"number"==typeof t.navigationType}(t))return{navigationType:"".concat(t.navigationType)}};var z=function(t){if(function(t){return"number"==typeof t.readyForUser}(t))return{readyForUser:J(t.readyForUser)}};var q=function(t){if(function(t){return"number"==typeof t.redirectCount}(t))return{redirectCount:"".concat(t.redirectCount)}};var B=function(t){if(function(t){return"number"==typeof t.resourceLoadedEnd}(t))return{resourceLoadedEnd:J(t.resourceLoadedEnd)}},K=function(t,e){Object.keys(t).forEach(function(n){e(n,t[n])})};function U(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function X(t){return Object.keys(t).length}var R=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.children={},this.values=[]}return function(t,e,n){e&&U(t.prototype,e),n&&U(t,n)}(t,[{key:"add",value:function(e,n){0==e.length?this.values.push(n):(this.children.hasOwnProperty(e[0])||(this.children[e[0]]=new t),this.children[e[0]].add(e.substr(1),n))}},{key:"toTrieObject",value:function(){var t={};return K(this.children,function(e,n){t[e]=n.toTrieObject()}),0===this.values.length?t:0===X(this.children)?this.values:[t,this.values]}},{key:"condensed",value:function(){var e=new t;return e.values=this.values.concat(),K(this.children,function(t,n){var r=n.condensed();0===r.values.length&&1===X(r.children)?K(r.children,function(n,r){e.children[t+n]=r}):e.children[t]=r}),e}}]),t}();var H={other:0,img:1,link:2,script:3,css:4,xmlhttprequest:5},W=-1;function Y(t){return(t=Math.floor(t||0))>0?function(t){return t.toString(36)}(t):""}var $=function(t){if(function(t){return Array.isArray(t.resourceTiming)}(t)){var e=new R;return t.resourceTiming.forEach(function(t){var n=function(t){return T.reduce(function(e,n){var r=n(t);return r.length>e.length?r:e},"")}(t.name);e.add(n||"â˜ ",function(t){return[H[t.initiatorType]||W,Y(t.startTime),Y(t.responseEnd),Y(t.responseStart),Y(t.requestStart),Y(t.connectEnd),Y(t.secureConnectionStart),Y(t.connectStart),Y(t.domainLookupEnd),Y(t.domainLookupStart),Y(t.redirectEnd),Y(t.redirectStart)].join(",").replace(/,+$/,"")}(t))}),{resourceTiming:JSON.stringify(e.condensed().toTrieObject())}}};var G=function(t){if(function(t){return"number"==typeof t.threshold}(t))return{threshold:J(t.threshold)}},Q="unloadEventStart,unloadEventEnd,redirectStart,redirectEnd,fetchStart,domainLookupStart,domainLookupEnd,connectStart,connectEnd,secureConnectionStart,requestStart,responseStart,responseEnd,domLoading,domInteractive,domContentLoadedEventStart,domContentLoadedEventEnd,domComplete,loadEventStart,loadEventEnd".split(","),V=function(t){var e={};return Q.forEach(function(n){"number"==typeof t[n]&&(e[n]=J(t[n]))}),e};var Z=function(t){if(function(t){return"string"==typeof t.userAgent}(t))return{userAgent:t.userAgent}};function tt(t){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var et=function(t){if(function(t){return"object"===tt(t.marks)}(t)){var e={},n={},r={};return t.marks.forEach(function(t){var e="mark.".concat(t.name);n[e]=n[e]||[],n[e].push(Math.floor(t.time))}),K(n,function(t,n){e[t]=JSON.stringify(n)}),t.measures.forEach(function(t){var e="measure.".concat(t.name);r[e]=r[e]||[],r[e].push([Math.floor(t.startTime),Math.floor(t.duration)])}),K(r,function(t,n){e[t]=JSON.stringify(n)}),e}};var nt=function(t){if(function(t){return"number"==typeof t.serverDuration}(t))return{serverDuration:"".concat(Math.floor(t.serverDuration))}};w.listen(),j.a.addReporter(k),function(t){P=t}(w);var rt=function(t){A.push(t)};rt(I),rt(L),rt(M),rt(D),rt(F),rt(N),rt(x),rt(z),rt(q),rt(B),rt($),rt(G),rt(V),rt(Z),rt(et),rt(nt),j.a.subscribe(function(t){C(t.report)})},"r+Ch":function(t,e,n){"use strict";var r=n("Jygk"),o=n.n(r);n("DrFn"),n("LgON");e.a=o.a["browser-metrics"]}}]);
//# sourceMappingURL=setup-analytics.3cc3937841b0bc1e1f23-v35.js.map