(window.webpackJsonp=window.webpackJsonp||[]).push([[232],{"96U/":function(e,t,i){"use strict";var n=i("ERkP"),o=i.n(n),s=i("7nmT"),r=i.n(s),a=i("Jygk"),c=i.n(a),l=i("aWzz"),d=i.n(l),u=i("uDfI"),h=i("6DRV"),m=i("L21V"),f=i("lZoD"),p=i("kD2R"),g=i("3wLf"),v=i("Qq6k"),y=i("ydSU"),b=i("ZLH2"),C=i("vplL"),w=i("c09o"),k=i("OjRD"),E=i("9Ivk"),S=i("uh42"),T=i("HEM+"),x=i("OLUx"),O=i("lPJD"),P=i("s72O"),R=i("PP1O"),M=i("r9hL"),_=i("d3tz"),$=i("gHio"),D=i.n($),N=i("dDc+"),I=i("KsTJ");function H(){var e=V(["\n  flex: 0 0 auto;\n  appearance: none;\n  background: none;\n  border: none;\n  color: ",";\n  cursor: pointer;\n\n  &:focus {\n    outline: none;\n  }\n"]);return H=function(){return e},e}function A(){var e=V(["\n  flex-grow: 1;\n  color: ",";\n  text-align: center;\n"]);return A=function(){return e},e}function L(){var e=V(["\n  display: flex;\n  background-color: ",";\n  border-radius: 5px;\n  align-items: center;\n  overflow: hidden;\n  height: ","px;\n  transition: height 0.25s linear;\n"]);return L=function(){return e},e}function V(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var U=I.default.div(L(),N.colors.P300,function(e){return e.isOpen?50:0}),j=I.default.p(A(),"white"),F=I.default.button(H(),"white");function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function W(e,t){return(W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var G,Q=function(e){function t(){var e,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(X(X(i=function(e,t){return!t||"object"!==z(t)&&"function"!=typeof t?X(e):t}(this,(e=q(t)).call.apply(e,[this].concat(o))))),"onDismiss",function(e){var t=i.props.onDismiss;e.stopPropagation(),e.preventDefault(),t()}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(t,n["Component"]),function(e,t,i){t&&B(e.prototype,t),i&&B(e,i)}(t,[{key:"render",value:function(){var e=this.props.isOpen;return o.a.createElement(U,{isOpen:e},o.a.createElement(j,null,o.a.createElement(m.b,{id:"changeboarding.dnd.pagetree.spacesettings.banner"})),o.a.createElement(F,{onClick:this.onDismiss},o.a.createElement(D.a,null)))}}]),t}();function J(e){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function K(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Y(e){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Z(e,t){return(Z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ee(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function te(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Q.displayName="ReorderPagesBannerComponent";var ie,ne=Object(M.b)(_.a.CHANGEBOARDING)(G=function(e){function t(){var e,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return te(ee(ee(i=function(e,t){return!t||"object"!==J(t)&&"function"!=typeof t?ee(e):t}(this,(e=Y(t)).call.apply(e,[this].concat(o))))),"state",{isOpen:!1}),te(ee(ee(i)),"onDismiss",function(){var e=i.props,t=e.triggerAnalytics,n=e.stop;i.setState({isOpen:!1}),t("reorderpages-banner-dismissed"),n()}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Z(e,t)}(t,n["Component"]),function(e,t,i){t&&K(e.prototype,t),i&&K(e,i)}(t,[{key:"componentWillMount",value:function(){this.el=c.a.document.getElementById("reorderpages-changeboarding-react-portal-placeholder")}},{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){e.setState({isOpen:!0})},200)}},{key:"render",value:function(){var e=this.state.isOpen;return this.el?r.a.createPortal(o.a.createElement(Q,{isOpen:e,onDismiss:this.onDismiss}),this.el):null}}]),t}())||G;function oe(e){return(oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function se(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function re(e){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ae(e,t){return(ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ce(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function le(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var de=Object(T.b)(ie=Object(P.a)(ie=function(e){function t(){var e,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return le(ce(ce(i=function(e,t){return!t||"object"!==oe(t)&&"function"!=typeof t?ce(e):t}(this,(e=re(t)).call.apply(e,[this].concat(o))))),"shouldShowSpaceSettingChangeboarding",function(){return i.isOnReorderPages()&&i.isDragDropEnabled()}),le(ce(ce(i)),"isOnReorderPages",function(){var e=i.props,t=e.matchRoute,n=e.location;return t(n.pathname+n.search)===R.SPACE_SETTINGS_REORDERPAGES.name}),le(ce(ce(i)),"isDragDropEnabled",function(){return i.props.featureFlags["confluence.frontend.atlaskit.pagetree.draggable"]}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}(t,n["Component"]),function(e,t,i){t&&se(e.prototype,t),i&&se(e,i)}(t,[{key:"render",value:function(){var e=this.props.coordinationClient;return this.shouldShowSpaceSettingChangeboarding()?o.a.createElement(O.a,{client:e,messageId:"confluence-dragdrop-spacesettings-banner"},o.a.createElement(ne,null)):null}}]),t}())||ie)||ie;function ue(e){return(ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function he(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function me(e,t){return!t||"object"!==ue(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function fe(e){return(fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pe(e,t){return(pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ge=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),me(this,fe(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pe(e,t)}(t,n["Component"]),function(e,t,i){t&&he(e.prototype,t),i&&he(e,i)}(t,[{key:"render",value:function(){return o.a.createElement(x.a,null,function(e){var t=e.featureFlags;return o.a.createElement(de,{featureFlags:t})})}}]),t}();function ve(e){return(ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ye(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function be(e){return(be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ce(e,t){return(Ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function we(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}ge.displayName="DragDropChangeboarding";var ke=function(e){function t(){var e,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(we(we(i=function(e,t){return!t||"object"!==ve(t)&&"function"!=typeof t?we(e):t}(this,(e=be(t)).call.apply(e,[this].concat(o))))),"state",{}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ce(e,t)}(t,n["Component"]),function(e,t,i){t&&ye(e.prototype,t),i&&ye(e,i)}(t,[{key:"getChildContext",value:function(){return{insertCss:this.props.context.insertCss||function(){}}}},{key:"componentDidMount",value:function(){var e=this,t=this.props.locale;Object(w.a)(t,function(){Object(C.a)({locale:t},function(i,n){e.setState({i18nConfig:{locale:t,messages:n}})})})}},{key:"render",value:function(){if(!this.state.i18nConfig)return null;var e=this.props,t=e.store,i=e.locale;return o.a.createElement(v.a,null,o.a.createElement(u.Provider,{store:t},o.a.createElement(p.ConnectedRouter,{history:S.a},o.a.createElement(h.ApolloProvider,{client:g.a},o.a.createElement(T.a,{locale:i},o.a.createElement(f.b,null,o.a.createElement(y.a,{namedRoutes:b},o.a.createElement(m.e,this.state.i18nConfig,o.a.createElement(E.a,null,this.props.children,o.a.createElement(k.b,null),o.a.createElement(ge,null))))))))))}}]),t}();ke.displayName="Wrapper",ke.displayName="Wrapper",ke.childContextTypes={insertCss:d.a.func.isRequired};var Ee=i("AeT/"),Se=Object(Ee.a)({isServerRenderedPage:!0});i.e(574).then(i.bind(null,"Al9w")).then(function(e){e.subscribe(Se)});var Te={insertCss:function(e){return e._insertCss()}};t.a=function(e,t){"string"==typeof t&&(t=c.a.document.getElementById(t)),r.a.render(o.a.createElement(ke,{store:Se,context:Te,locale:c.a.__INITIAL_STATE__.i18n.locale},e),t)}},i8tr:function(e,t,i){"use strict";i.r(t);var n=i("xeH2"),o=i.n(n),s=i("HvGa"),r=i.n(s),a=i("jqY8"),c=i("Jygk"),l=i.n(c),d=i("+frj"),u=i.n(d),h=i("UYEP"),m=i.n(h),f=new(m.a.View.extend({initialize:function(){this.setPageContentElByCSSSelector("#content"),this.pageHeader=null},destroy:function(){this.el&&(this.el.style.minHeight="",this.el.classList.remove("ic-shrink-to-show-sidebar")),this.pageHeader&&this.pageHeader.classList.remove("ic-shrink-to-show-sidebar")},setPageContentElByCSSSelector:function(e){var t=!1;if(e){var i=l.a.document.querySelector(e);i?this.setElement(i):t=!0}else t=!0;if(t){var n=l.a.document.querySelector("#content");this.setElement(n)}},setPageHeaderElByCSSSelector:function(e){this.pageHeader=e?l.a.document.querySelector(e):null},shrinkToShowSideBar:function(){this.el.classList.add("ic-shrink-to-show-sidebar"),this.pageHeader&&this.pageHeader.classList.add("ic-shrink-to-show-sidebar")},updateMinHeight:function(e){var t=e-this.$el.offset().top,i=parseInt(this.el.style.minHeight,10);(t>i||isNaN(i))&&(this.el.style.minHeight="".concat(t,"px"))}})),p=l.a.top,g={INLINE_COMMENTS:r.a.DarkFeatures.isEnabled("confluence-inline-comments"),RESOLVED_INLINE_COMMENTS:r.a.DarkFeatures.isEnabled("confluence-inline-comments-resolved"),RICH_TEXT_EDITOR:r.a.DarkFeatures.isEnabled("confluence-inline-comments-rich-editor"),DANGLING_COMMENT:r.a.DarkFeatures.isEnabled("confluence-inline-comments-dangling-comment"),LIKES_ADMIN_TOGGLE:r.a.DarkFeatures.isEnabled("optional-likes-CONFDEV-53297")},v=["dateautocomplete","confluencemacrobrowser","propertypanel","jiraconnector","dfe"],y=["autoresize","confluenceleavecomment"],b=["code"];function C(e,t,i,n,o){null!=t&&(t.isResolved()?new i({collection:e,focusCommentId:t.get("id"),formatMessage:o}).render():t.isDangling()||m.a.trigger("ic:view",t,"permalink",{isReplyComment:n}))}function w(e){if("number"==typeof e.selectionStart){var t=e.value.length;e.selectionStart=t,e.selectionEnd=t}else if(null!=typeof e.createTextRange){e.focus();var i=e.createTextRange();i.collapse(!1),i.select()}}function k(e){var t=o()(e).closest("a");return t.length||(t=o()(e).find("a")),t}function E(){return!!o()(".ic-sidebar #wysiwygTextarea_ifr").length}function S(e,t,i){i=i||1,e=e||o()(p).scrollTop();var n=o.a.Deferred(),s={duration:100,step:function(e){o()(p).scrollTop(e)},complete:function(){setTimeout(n.resolve,i)}};return o()({scrollTop:e}).animate({scrollTop:t},s),n.promise()}function T(){var e=l.a.frameElement&&l.a.frameElement.getAttribute("name"),t=l.a.frameElement&&"true"===l.a.frameElement.getAttribute("data-is-fallback-mode-iframe");return l.a.top!==l.a.self&&e&&"fallback-mode-iframe"===e||t}var x={overlappedSelection:function(e,t){if(e&&t){var i=o()(e.containingElement);if(i.is(".inline-comment-marker.valid")||(i=o()("<div/>").append(e.html).find(".inline-comment-marker.valid")),i.length>0&&function(e){return e.filter(function(){return o()(this).text().length>0}).length>0}(i)){var n=i.first().data("ref");return t.findWhere({markerRef:n})}}},focusedCommentUrl:function(e){return"".concat(r.a.contextPath(),"/pages/viewpage.action?pageId=").concat(r.a.Meta.get("latest-page-id"),"&focusedCommentId=").concat(e,"#comment-").concat(e)},showFocusedComment:function(e,t,i,n){var s=t.match(/(focusedCommentId|replyToComment)=(\d+)/);if(null!=s){var a="replyToComment"===s[1],c=parseInt(s[2],10);if(e.findWhere){var l=e.findWhere({id:c});null!=l?C(e,l,i,a,n):o.a.ajax({url:"".concat(r.a.contextPath(),"/rest/inlinecomments/1.0/comments/replies/").concat(c,"/commentId")}).done(function(t){l=e.findWhere({id:t}),C(e,l,i,a,n)})}}},getAuthorAvatarUrl:function(){return r.a.Meta.get("current-user-avatar-url")?r.a.contextPath()+r.a.Meta.get("current-user-avatar-url"):"".concat(r.a.Meta.get("static-resource-url-prefix"),"/images/icons/profilepics/anonymous.png")},moveCaretToEnd:function(e){w(e),l.a.setTimeout(function(){w(e)},1)},animateSidebar:function(e,t){var i="webkitAnimationEnd oanimationend msAnimationEnd animationend",n=e.$wikiContent,s=o.a.Deferred();if(t){var r=o()(".inline-comment-marker.active");n.addClass("ic-fade-in-animation"),n.one(i,function(){o()(this).removeClass("ic-fade-in-animation")}),e.$el.addClass("ic-slide-in"),e.$el.one(i,function(){o()(this).removeClass("ic-slide-in"),r.addClass("ic-highlight-pulse"),r.one(i,function(){r.removeClass("ic-highlight-pulse")})}),s.resolve()}else n.bind(i,function(t){"ic-fade-out-animation"==t.originalEvent.animationName?(e.$wikiContent.removeClass("ic-fade-out-animation"),e.$wikiContent.css("opacity","0.5")):"ic-fade-in-animation"==t.originalEvent.animationName&&(e.$wikiContent.css("opacity","1"),e.$wikiContent.removeClass("ic-fade-in-animation"),e.$wikiContent.unbind(i))}),n.addClass("ic-fade-out-animation"),e.$el.addClass("ic-slide-out"),e.$el.on(i,function t(){e.$el.removeClass("ic-slide-out"),e._emptySidebar(),f.destroy(),n.addClass("ic-fade-in-animation"),n.css("position","static"),s.resolve(),e.$el.off(i,t)});return s.promise()},getDarkFeatures:function(){return u.a.clone(g)},getInlineLinks:k,removeInlineLinksDialog:function(e){e.each(function(){var e=k(this);e.length&&e.off("mousemove")})},isAnimationSupported:function(){return void 0!==document.body.style.animation||void 0!==document.body.style.webkitAnimation},showHighlightContent:function(e){e.parents(".expand-content.expand-hidden").each(function(){o()(this).siblings(".expand-control").click()})},getUnsupportedRtePlugins:function(){return u.a.clone(v)},getSupportedRtePlugins:function(){return u.a.clone(y)},confirmProcess:function(e,t){var i=r.a.Rte&&r.a.Rte.getEditor&&r.a.Rte.getEditor();if(!0===t){if(E()&&i&&i.isDirty())return confirm(e({id:"inline.comments.editor.lost"}))}else if(i&&i.isDirty()&&l.a.Confluence.Editor&&!l.a.Confluence.Editor.getContentType)return confirm(e({id:"inline.comments.editor.lost"}));return!0},getAuthorDisplayName:function(){return r.a.Meta.get("user-display-name")||r.a.Meta.get("current-user-fullname")},isKeyboardShortcutsEnable:function(){return r.a.Meta.get("use-keyboard-shortcuts")&&l.a.Confluence.KeyboardShortcuts&&l.a.Confluence.KeyboardShortcuts.enabled},addSidebarHeadingTooltip:function(e){e.$("button.ic-action-hide").tooltip({gravity:"se"}),e.$("#ic-nav-next").tooltip({gravity:"s"}),e.$("#ic-nav-previous").tooltip({gravity:"s"})},hasEditorInSidebar:E,recalculateContentHeight:function(e){var t=e.height(),i=e.offset().top+t;f.updateMinHeight(i)},resizeContentAfterLoadingImages:function(e){e=e.closest(".ic-display-comment-view");var t=this,i=o()(".confluence-embedded-image, .confluence-embedded-file img",e),n=i.length,s=0;n>0&&i.off("load").one("load",function(){++s===n&&t.recalculateContentHeight(e)}).each(function(){this.complete&&o()(this).load()})},scrollToCommentAfterToggleSideBar:function(e,t,i){var n=function(){var i=t&&t.is(":visible");if(e&&i){var n=t.offset().top-e;o()(p).scrollTop(n)}};(i=void 0!==i?i:T())?setTimeout(n,1):n()},getEditorFormat:function(e){var t=o.a.Deferred();return o.a.ajax({url:"".concat(r.a.contextPath(),"/rest/api/content/").concat(e,"?expand=body.editor"),type:"GET",dataType:"json",contentType:"application/json; charset=utf-8"}).then(function(e){var i=e.body.editor.value;t.resolve(i)}).fail(function(e,i,n){t.reject(e,i,n)}),t.promise()},containUnsupportedMacro:function(e){var t=e.closest(".conf-macro");return!1===t.data("hasbody")||e.find('.conf-macro[data-hasbody="false"]').length>0||-1!=b.indexOf(t.data("macro-name"))},containInternalLink:function(e){return e.closest(".user-mention").length>0||e.find(".user-mention").length>0},containUserMetion:function(e){return e.closest("a[href^='/']:not('.user-mention')").length>0||e.find("a[href^='/']:not('.user-mention')").length>0},getCurrentUserInfo:function(){var e={isDefault:!0,path:"".concat(r.a.Meta.get("static-resource-url-prefix"),"/images/icons/profilepics/default.png")};"/images/icons/profilepics/default.png"!==r.a.Meta.get("current-user-avatar-url")&&(e={isDefault:!1,path:r.a.contextPath()+r.a.Meta.get("current-user-avatar-url")});var t=r.a.Meta.get("remote-user");return{userName:""==t?null:t,displayName:r.a.Meta.get("current-user-fullname"),profilePicture:e}},getOffsetTopRelativeInWindowCoordinate:function(e){return e.offset().top-o()(p).scrollTop()},scrollToActiveHighlight:function(e,t){var i=o()(p).scrollTop();return S(i,i+e-t)},scrollToTop:function(){return S(null,0,100)},sendMessageToParent:function(e){e.bridgeId="".concat(function(){return l.a.frameElement&&l.a.frameElement.getAttribute("data-bridge-id")}()),l.a.parent.postMessage(e,l.a.location.origin)},isFallbackModeIframe:T,isSPAPage:function(){return o()("#confluence-ui").length>0},getPageContentClassName:function(){return"view-page-body"}},O=m.a.Model.extend({defaults:{authorDisplayName:x.getAuthorDisplayName(),authorUserName:r.a.Meta.get("remote-user"),authorAvatarUrl:r.a.contextPath()+r.a.Meta.get("current-user-avatar-url"),body:"",commentId:"0",hasDeletePermission:!0,hasEditPermission:!!r.a.Meta.get("remote-user")},urlRoot:function(){return"".concat(r.a.contextPath(),"/rest/inlinecomments/1.0/comments/").concat(this.get("commentId"),"/replies")},sync:function(e,t,i){return i=i||{},"create"===e&&(i.url="".concat(this.urlRoot(),"?containerId=").concat(r.a.Meta.get("latest-page-id"))),m.a.sync.call(this,e,t,i)},validate:function(){if(!this.get("body"))return!0}}),P=m.a.Collection.extend({model:O}),R=m.a.Model.extend({defaults:{authorDisplayName:x.getAuthorDisplayName(),authorUserName:r.a.Meta.get("remote-user"),authorAvatarUrl:r.a.contextPath()+r.a.Meta.get("current-user-avatar-url"),body:"",originalSelection:"",parentCommentId:"0",lastFetchTime:o()("meta[name=confluence-request-time]").attr("content"),hasDeletePermission:!0,hasEditPermission:!0,hasResolvePermission:!0,resolveProperties:{resolved:!1,resolvedTime:0},serializedHighlights:"",deleted:!1},urlRoot:"".concat(r.a.contextPath(),"/rest/inlinecomments/1.0/comments"),initialize:function(e){e=e||{},this._setHighlights(e.markerRef);var t=this;this.replies=new P,this.replies.url=function(){return"".concat(t.url(),"/replies")},this.set({containerId:r.a.Meta.get("latest-page-id")},{silent:!0}),this.set({containerType:r.a.Meta.get("content-type")},{silent:!0}),x.getDarkFeatures().DANGLING_COMMENT&&r.a.Meta.get("page-id")===r.a.Meta.get("latest-page-id")&&this.isDangling()&&!this.isResolved()&&this.resolve(!0,{wait:!0,dangling:!0,success:u.a.bind(function(){m.a.trigger("ic:open:dangled",this)},this),error:u.a.bind(function(){m.a.trigger("ic:resolve:dangled:failed",this)},this)})},validate:function(){if(!this.get("body"))return!0},resolve:function(e,t){t=t||{},this.save({},u.a.extend(t,{url:"".concat(this.urlRoot,"/").concat(this.get("id"),"/resolve/").concat(e,"/dangling/").concat(!0===t.dangling)}))},isResolved:function(){return this.get("resolveProperties").resolved},isDangling:function(){return void 0===this.highlight},isDeleted:function(){return this.get("deleted")},_setHighlights:function(e){var t;0!==(t=void 0!==e?o()("[data-inline-comments-target=true]:first").find('.inline-comment-marker[data-ref="'.concat(e,'"],span[data-reference="').concat(e,'"]')):o()(".ic-current-selection")).length?(this.highlights=t,this.highlight=t.first()):(this.highlights=void 0,this.highlight=void 0)},destroy:function(e){var t=this,i=(e=e?u.a.clone(e):{}).success;return e.success=function(n){i&&i(t,n,e)},function(e,t){var i=t.error;t.error=function(n){i&&i(e,n,t),e.trigger("error",e,n,t)}}(this,e),this.sync("delete",this,e)}}),M=m.a.Collection.extend({model:R,initialize:function(){this.listenTo(this,"sort",this._removeCachedMarkers)},url:function(){var e=r.a.contextPath(),t=r.a.Meta.get("page-id");return"".concat(e,"/rest/inlinecomments/1.0/comments?")+"containerId=".concat(t)},getResolvedCount:function(){return this.getResolvedComments().length},getUnresolveCount:function(){return this.reject(function(e){return!0===e.isResolved()&&!1===e.isDeleted()}).length},getResolvedComments:function(){return this.filter(function(e){return!0===e.isResolved()&&!1===e.isDeleted()})},getResolvedCommentsDesc:function(){return u.a.sortBy(this.getResolvedComments(),function(e){return 0-e.get("resolveProperties").resolvedTime})},getNextCommentOnPage:function(){return this._getCommentAtRelativeOffset(1)},getPrevCommentOnPage:function(){return this._getCommentAtRelativeOffset(-1)},_getCommentAtRelativeOffset:function(e){var t=this.getCommentsOnPage(),i=this.findWhere({active:!0});if(void 0===i||t.length<=1)return null;var n=u.a.pluck(t,"id");return t[(u.a.indexOf(n,i.get("id"))+e+t.length)%t.length]},getCommentsOnPage:function(){return this.filter(function(e){return!1===e.isResolved()&&!e.isDangling()&&!1===e.isDeleted()||!0===e.get("active")})},getCommentsOnPageCount:function(){return this.getCommentsOnPage().length},getActiveIndexWithinPageComments:function(){var e=u.a.pluck(this.getCommentsOnPage(),"id"),t=this.findWhere({active:!0});if(void 0===t)return null;var i=t.get("id");return u.a.indexOf(e,i)},comparator:function(e,t){return void 0===this.markers&&(this.markers=o()("[data-inline-comments-target=true]:first").find(".inline-comment-marker")),void 0===e.highlight?1:void 0===t.highlight?-1:this.markers.index(e.highlight)-this.markers.index(t.highlight)},_removeCachedMarkers:function(){this.markers=void 0}}),_={};u.a.extend(_,m.a.Events),_.start=function(){!0!==this.running&&(this.running=!0,this.send=function(e,t){r.a.trigger("analytics",{name:e,data:t})},this.listenTo(m.a,"ic:highlight-panel-click",function(){this.send("confluence.highlight.actions.comment.inline")}),this.listenTo(m.a,"ic:view",function(e,t){this.send("confluence.comment.inline.view"),"nav"===t&&this.send("confluence.comment.inline.view.nav"),"permalink"===t&&this.send("confluence.comment.inline.view.permalink")}),this.listenTo(m.a,"ic:overlap",function(){this.send("confluence.comment.inline.overlap")}),this.listenTo(m.a,"ic:edit",function(){this.send("confluence.comment.inline.edit")}),this.listenTo(m.a,"ic:persist",function(){this.send("confluence.comment.inline.create")}),this.listenTo(m.a,"ic:sidebar:close",function(){this.send("confluence.comment.inline.sidebar.close")}),this.listenTo(m.a,"ic:reply:persist",function(){this.send("confluence.comment.inline.reply")}),this.listenTo(m.a,"ic:delete ic:reply:delete",function(){this.send("confluence.comment.inline.delete")}),this.listenTo(m.a,"ic:resolved",function(){this.send("confluence.comment.inline.resolved")}),this.listenTo(m.a,"ic:unresolved",function(){this.send("confluence.comment.inline.unresolved")}),this.listenTo(m.a,"ic:resolved:view",function(e){var t={total:e};this.send("confluence.comment.inline.resolved.view",t)}),this.listenTo(m.a,"ic:resolved:dismiss:recovery",function(){this.send("confluence.comment.inline.resolved.dismiss")}),this.listenTo(m.a,"ic:resolved:show:recovery",function(){this.send("confluence.comment.inline.resolved.discovery")}),this.listenTo(m.a,"ic:open:dangled",function(e){var t={commentId:e.get("id"),pageId:r.a.Meta.get("page-id")};this.send("confluence.comment.inline.open.dangled",t)}),this.listenTo(m.a,"ic:editor:load:fail",function(){var e={pageId:r.a.Meta.get("page-id")};this.send("confluence.comment.inline.editor.load.fail",e)}),this.listenTo(m.a,"ic:resolve:dangled:failed",function(e){var t={commentId:e.get("id"),pageId:r.a.Meta.get("page-id")};this.send("confluence.comment.inline.resolved.dangled.failed",t)}))},_.stop=function(){this.running=!1,this.stopListening()};var $=_,D=(i("wS3D"),"ic-current-selection");function N(){o.a.textHighlighter.createWrapper=function(e){return o()("<span></span>").addClass(e.highlightedClass)},this.$el=o()("[data-inline-comments-target=true]").first(),this.$el.length>0&&this.$el.textHighlighter({highlightedClass:D})}N.prototype.highlight=function(e){if(0!==this.$el.length){var t=o()(this.$el.getHighlighter().doHighlight(e));return this.$el.getHighlighter().serializeHighlights(t)}},N.prototype.removeHighlight=function(){if(0!==this.$el.length)return this.$el.getHighlighter().removeHighlights(),this},N.prototype.deserializeHighlights=function(e,t){if(0!==this.$el.length){var i='<span class="inline-comment-marker" data-ref="'.concat(t,'"></span>');return this.$el.getHighlighter().deserializeHighlights(e,i)}};var I=N;function H(e,t){return'<div class="ic-sidebar-heading"><div id="ic-nav-container">'.concat(1==e.createComment?U({disabled:!0,showIndex:!1},t):"",'</div><div class="ic-right-toolbar">').concat(e.showMenu?function(e,t){return"".concat(e.darkFeatures.INLINE_COMMENTS&&(e.hasDeletePermission||e.hasReplyPermission||e.hasResolvePermission&&e.darkFeatures.RESOLVED_INLINE_COMMENTS)?l.a.aui.buttons.button({type:"subtle",extraClasses:"aui-button-compact aui-dropdown2-trigger-arrowless aui-style-default ic-action-menu",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-more",text:"",dropdown2Target:"ic-menu-items"})+l.a.aui.dropdown2.contents({id:"ic-menu-items",extraClasses:"aui-style-default",content:'<ul class="aui-list-truncate">'.concat(e.hasResolvePermission&&e.darkFeatures.RESOLVED_INLINE_COMMENTS?'<li class="ic-action-resolve"><a href="#">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.resolve"})),"</a></li>"):"").concat(e.hasReplyPermission?'<li class="ic-action-reply"><a href="#">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.reply"})),"</a></li>"):"").concat(e.hasEditPermission?'<li class="ic-action-edit"><a href="#">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.edit"})),"</a></li>"):"").concat(e.hasDeletePermission?'<li class="ic-action-delete"><a href="#">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.delete"})),"</a></li>"):"","</ul>")}):"")}(e,t):"").concat(l.a.aui.buttons.button({type:"text",extraClasses:"aui-button-text ic-action-hide",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-close-dialog",text:"",extraAttributes:{title:t({id:"inline.comments.sidebar.tooltip.close.description"})}}),'</div></div><div class="ic-error"></div>')}function A(e,t){return'<div class="ic-author">'.concat(function(e){return"".concat(""==e.authorUserName?l.a.aui.avatar.avatar({size:e.size,avatarImageUrl:e.authorAvatarUrl,extraClasses:"ic-author-avatar"}):'<a data-username="'.concat(l.a.soy.$$escapeHtml(e.authorUserName),'" href="').concat(l.a.soy.$$escapeHtml("/wiki"),"/display/~").concat(l.a.soy.$$escapeHtml(e.authorUserName),'" title="" data-user-hover-bound="true">').concat(l.a.aui.avatar.avatar({size:e.size,avatarImageUrl:e.authorAvatarUrl,extraClasses:"ic-author-avatar"}),"</a>"))}({authorUserName:e.authorUserName,authorAvatarUrl:e.authorAvatarUrl,size:"small"})).concat(function(e){return"".concat(e.username&&""!=e.username?'<a href="'.concat(function(e){return"".concat(l.a.soy.$$escapeHtml("/wiki"),"/display/~").concat(l.a.soy.$$escapeUri(e.username))}(e),'"').concat(e.canView?'class="url fn confluence-userlink" data-username="'.concat(l.a.soy.$$escapeHtml(e.username),'"'):'class="url fn"',">").concat(e.fullName&&""!=e.fullName?l.a.soy.$$escapeHtml(e.fullName):l.a.soy.$$escapeHtml(e.username),"</a>"):l.a.soy.$$escapeHtml("Anonymous"))}({canView:""!=e.authorUserName,username:e.authorUserName,fullName:e.authorDisplayName}),"</div>")}function L(e,t){var i='<div class="ic-container ic-create-comment">'.concat(A(e),'<div class="ic-body"><form class="aui" action="">');if(e.darkFeatures.RICH_TEXT_EDITOR)i+='<div class="loading-container" />';else{var n="".concat("reply"==e.type?l.a.soy.$$escapeHtml(t({id:"inline.comments.create.reply.placeholder"})):l.a.soy.$$escapeHtml(t({id:"inline.comments.create.placeholder"})));i+='<textarea class="textarea ic-textarea" name="body" placeholder="'.concat(l.a.soy.$$escapeHtml(n),'">').concat(l.a.soy.$$escapeHtml(e.text),'</textarea><div class="ic-actions"><ul><li>').concat(l.a.aui.buttons.button({tagName:"button",text:t({id:"inline.comments.sidebar.save"}),type:"link",extraClasses:"ic-action-save",isDisabled:!0}),"</li>").concat("topLevel"!=e.type?"<li>".concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.cancel"}),type:"link",extraClasses:"ic-action-discard"}),"</li>"):"","</ul></div>")}return i+="</form></div></div>"}function V(e,t){return'<div data-comment-id="'.concat(l.a.soy.$$escapeHtml(e.id),'" class="ic-container ic-display-comment">').concat(A(e),'<div class="ic-body wiki-content"><div class="ic-content">').concat(e.resolveProperties.resolved?'<blockquote><span class="ic-resolved-marker">'.concat(l.a.soy.$$escapeHtml(e.originalSelection),"</span></blockquote>"):"").concat(l.a.soy.$$filterNoAutoescape(e.body),"</div></div>").concat(e.resolveProperties.resolved?function(e,t){return"".concat(e.darkFeatures.INLINE_COMMENTS?'<div class="ic-actions"><ul class="aui-list-truncate">'.concat(e.hasResolvePermission&&!e.isDangling?"<li>".concat(l.a.aui.buttons.button({text:t({id:"inline.comments.resolved.menu.unresolve"}),type:"link",extraClasses:"ic-action-unresolve"}),"</li>"):"",'<li class="hidden">').concat(l.a.aui.buttons.button({type:"link",extraClasses:"ic-action-show-reply"}),"</li>").concat((e.hasReply,"")).concat(e.resolveProperties.resolvedTime>0?'<li class="ic-resolved-message">'.concat(l.a.aui.icons.icon({useIconFont:!0,size:"small",icon:"success"}),"  <span>").concat(j({time:"".concat(e.isDangling&&e.resolveProperties.resolvedByDangling?l.a.soy.$$filterNoAutoescape(t({id:"inline.comments.resolved.dangling.message"},{0:e.resolveProperties.resolvedUser,1:e.resolveProperties.resolvedFriendlyDate})):l.a.soy.$$filterNoAutoescape(t({id:"inline.comments.resolved.message"},{0:e.resolveProperties.resolvedUser,1:e.resolveProperties.resolvedFriendlyDate}))),commentUrl:e.commentDateUrl}),"</span></li>"):"","</ul></div>"):"")}(e,t):function(e,t){return"".concat(e.darkFeatures.INLINE_COMMENTS?'<div class="ic-actions"><ul class="aui-list-truncate">'.concat(e.hasResolvePermission&&e.darkFeatures.RESOLVED_INLINE_COMMENTS?"<li>".concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.resolve"}),type:"link",extraClasses:"ic-action-resolve"}),"</li>"):"",'<li class="ic-action-like"></li><li class="ic-date">').concat(j({time:e.lastModificationDate,commentUrl:e.commentDateUrl}),"</li></ul></div>"):"")}(e,t),"</div>").concat(!e.resolveProperties.resolved&&e.resolveProperties.resolvedTime>0&&e.resolveProperties.resolvedUser?'<div class="ic-unresolved-message">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.unresolved.message"},{0:e.resolveProperties.resolvedUser,1:e.resolveProperties.resolvedFriendlyDate})),"</div>"):"")}function U(e,t){return"".concat(l.a.aui.buttons.button({type:"text",id:"ic-nav-next",extraClasses:"aui-button-text",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-arrow-down",text:"",isDisabled:e.disabled,extraAttributes:{tabIndex:e.disabled?"":0,title:t({id:"inline.comments.sidebar.tooltip.next.ic.description"})}})).concat(l.a.aui.buttons.button({type:"text",id:"ic-nav-previous",extraClasses:"aui-button-text",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-arrow-up",text:"",isDisabled:e.disabled,extraAttributes:{tabIndex:e.disabled?"":0,title:t({id:"inline.comments.sidebar.tooltip.previous.ic.description"})}})).concat(e.showIndex?'<span class="ic-nav-x-out-of-y">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.navigation.index.of"},{0:e.index,1:e.size})),"</span>"):"")}function j(e){return'<a class="ic-date-link" title="'.concat(l.a.soy.$$escapeHtml(e.time),'" href="').concat(l.a.soy.$$escapeHtml("/wiki".concat(e.commentUrl)),'"><span>').concat(l.a.soy.$$escapeHtml(e.time),"</span></a>")}var F={comment:V,commentForm:L,confirmDialog:function(e,t){return'<strong class="ic-confirm-label">'.concat(l.a.soy.$$escapeHtml(e.label),'</strong><div class="ic-confirm-message">').concat(l.a.soy.$$escapeHtml(e.message),'</div><div class="ic-confirm-buttons">').concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.delete"}),tagName:"button",extraClasses:["ic-action-delete-confirm","aui-button-compact"]})).concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.cancel"}),tagName:"button",type:"link",extraClasses:["ic-action-cancel-confirm","aui-button-compact"]}),"</div>")},createComment:function(e,t){return'<div class="ic-comment-container">'.concat("topLevel"==e.type||"pageComment"==e.type?H({showMenu:!1,createComment:!0,darkFeatures:e.darkFeatures},t):"").concat(L(e,t),"</div>")},deleteComment:function(e){return'<div class="ic-comment-container ic-deleted">'.concat(H({createComment:!1,showMenu:!1},e),'<div class="ic-delete-comment-view"><h2><span class="aui-icon ic-delete-image line">::before</span>').concat(l.a.soy.$$escapeHtml(e({id:"inline.comments.sidebar.deleted"})),"</h2></div></div>")},displayComment:function(e,t){return'<div class="ic-comment-container">'.concat(H({authorUserName:e.authorUserName,hasDeletePermission:e.hasDeletePermission,hasResolvePermission:e.hasResolvePermission,hasEditPermission:e.hasEditPermission,hasReplyPermission:e.hasReplyPermission,showMenu:e.showMenu&&!e.resolveProperties.resolved,darkFeatures:e.darkFeatures},t)).concat(e.resolveProperties.resolved?function(e,t){return'<div class="ic-resolved-mask"><div class="ic-resolved-mask-content"><h2 class="ic-resolved-icon">'.concat(l.a.aui.icons.icon({useIconFont:!0,size:"large",icon:"success",extraClasses:"line"})).concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.resolved"})),'</h2></div><div class="resolved-message-container"><div class="resolved-message-sideline"><p>').concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.resolved.dialog.message"})),"</p>").concat(l.a.aui.buttons.button({text:t({id:"adg3.onboarding.docs.link"}),href:"https://confluence.atlassian.com/display/ConfCloud/Comment+on+pages+and+blog+posts#Commentonpagesandblogposts-Resolveinlinecomments",type:"link",extraAttributes:{target:"_blank"},id:"show-resolved-comments"}),"</div></div></div>")}(0,t):V(e,t),"</div>").concat(e.resolveProperties.resolved?"":'<div class="ic-list"></div><div class="ic-reply-container">'.concat(e.darkFeatures.INLINE_COMMENTS&&e.hasReplyPermission?'<div class="ic-reply-placeholder">'.concat(A({authorUserName:e.currentAuthorUserName,authorAvatarUrl:e.currentAuthorAvatarUrl,authorDisplayName:e.currentAuthorDisplayName}),'<div class="ic-body"><form class="aui"><textarea class="textarea ic-textarea" name="body" placeholder="').concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.create.reply.placeholder"})),'"></textarea></form></div></div>'):"","</div>"))},highlightTextLink:function(e){return"".concat(l.a.aui.icons.icon({useIconFont:!0,size:"small",icon:"link"}),"<a href='").concat(l.a.soy.$$escapeHtml(e.link),"'>").concat(l.a.soy.$$escapeHtml(e.link),"</a>")},likes:function(e,t){return"".concat(e.showLikeButton?l.a.aui.buttons.button({text:e.isLikedByUser?t({id:"inline.comments.likes.unlike"}):t({id:"inline.comments.likes.like"}),type:"link",extraClasses:"ic-like-button"}):"").concat(e.likesCount>0?'<span class="ic-like-summary"><span class="ic-small-like-icon"></span><a class="ic-likes-count" data-content-id="'.concat(l.a.soy.$$escapeHtml(e.contentId),'"><span class="ic-like-summary">').concat(l.a.soy.$$escapeHtml(e.likesCount),"</span></a></span>"):"")},navigation:U,pageComment:function(e,t){return'<div class="ic-comment-container">'.concat(H({createComment:!1,showMenu:!1},t),'<div class="ic-page-comment-view"><div class="ic-page-comment"><div class="ic-page-comment-content"><h2 class="ic-resolved-icon">').concat(l.a.aui.icons.icon({useIconFont:!0,size:"large",icon:"success",extraClasses:"line"})).concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.saved"})),'</h2></div><div class="ic-page-comment-message-container"><div class="ic-page-comment-message-sideline"><p>').concat(l.a.soy.$$escapeHtml(t({id:"page.comments.saved.dialog.message"})),'</p><button id="show-page-comment" class="aui-button aui-button-link" data-comment-id="').concat(l.a.soy.$$escapeHtml(e.commentId),'">').concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.resolved.dialog.show.me"})),"</button></div></div></div></div></div>")},renderReply:function(e,t){return"".concat(A(e),'<div class="ic-body wiki-content"><div class="ic-content ic-reply-content">').concat(l.a.soy.$$filterNoAutoescape(e.body),"</div></div>").concat(e.darkFeatures.INLINE_COMMENTS&&!e.resolved?function(e,t){return'<div class="ic-actions"><ul>'.concat(e.hasDeletePermission?"<li>".concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.delete"}),type:"link",extraClasses:"ic-action-delete-reply"}),"</li>"):"").concat(e.hasEditPermission?"<li>".concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.edit"}),type:"link",extraClasses:"ic-action-edit-reply"}),"</li>"):"",'<li class="ic-action-like-reply"></li><li class="ic-date">').concat(j({time:e.lastModificationDate,commentUrl:e.commentDateUrl}),"</li></ul></div>")}(e,t):"<div>".concat(j({time:e.lastModificationDate,commentUrl:e.commentDateUrl}),"</div>"))},resolvedCommentDialog:function(e,t){return"".concat(l.a.aui.dialog.dialog2({id:"ic-resolved-comment-dialog",removeOnHide:!0,extraClasses:"ic-resolved-comment-dialog-content",modal:!0,titleText:t({id:"inline.comments.resolved.view.menu"}),footerActionContent:"".concat(l.a.aui.buttons.button({id:"resolved-dialog-close-button",text:t({id:"inline.comments.sidebar.close"}),type:"link"})),content:'\x3c!-- Placeholder for error message --\x3e<div id="ic-resolved-comment-dialog-error" />'}))},showmoreReply:function(e,t){return'<div id="ic-showmore-container"><div class="ic-decor-line"/><div class="ic-decor-line"/><div class="ic-collapse-decor-center"><span>'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.expand.replies"},{0:e.totalReplies})),"</span></div></div>")}},z=m.a.View.extend({el:"[data-inline-comments-target=true]:first",events:{"click .inline-comment-marker.valid":"commentClick","click span[data-mark-type=confluenceInlineComment].valid":"commentClick"},initialize:function(){this.collection&&(this.listenTo(this.collection,"sync remove change:deleted",this.render),this.listenTo(this.collection,"change:active",this.setActive)),this.listenTo(m.a,"ic:view ic:overlap ic:sidebar-hidden",this.clearSelection),this.listenTo(m.a,"ic:persist",this.persistComment),this.listenTo(m.a,"ic:delete",this.render),r.a.bind("qr:add-new-highlight-text".concat(".ic-highlight"),this._addQuickReloadMarker)},destroy:function(){r.a.unbind(".ic-highlight"),this.stopListening(),this.undelegateEvents()},render:function(){this.inlineLinks=[],this.$(".inline-comment-marker,span[data-mark-type=confluenceInlineComment]").removeClass("valid"),this.collection.each(function(e){e.isResolved()||e.get("deleted")||!e.highlights||(e.highlights.addClass("valid"),this._pushToInlineLinks(e.highlights))},this),this._setupLinkDialog(),r.a.trigger("ic-highlight-rendered",this.collection)},_pushToInlineLinks:function(e){var t=this;e.each(function(){x.getInlineLinks(this).each(function(){o()(this).attr("href")&&t.inlineLinks.push(o()(this))})})},_setupLinkDialog:function(){var e={width:200,onHover:!0,noBind:!0,calculatePositions:this._calculatePositions,hideDelay:1e3};o()(this.inlineLinks).each(function(){var t=this;r.a.InlineDialog(t,"inline-comment-link",function(e,i,n){return e.addClass("inline-comment-link"),e.html(F.highlightTextLink({link:t.attr("href")})),n(),!1},e)})},_calculatePositions:function(e,t,i){return{displayAbove:!0,popupCss:{top:t.target.offset().top-e.height()-10,left:i.x-e.width()/2},arrowCss:{top:e.height(),left:e.width()/2-4}}},setActive:function(e){this.$(".inline-comment-marker,span[data-mark-type=confluenceInlineComment]").removeClass("active");var t=this.$('.inline-comment-marker[data-ref="'.concat(e.get("markerRef"),'"],span[data-reference="').concat(e.get("markerRef"),'"]'));e.get("active")&&t.length&&t.addClass("active")},commentClick:function(e){e.preventDefault(),e.stopPropagation();var t=this.$(e.currentTarget),i=t.parentsUntil(".active",".inline-comment-marker.valid");t.hasClass("active")?m.a.trigger("ic:hide-sidebar",e,!0):i.length>0?this.displayComment(i.last()):this.displayComment(t)},displayComment:function(e,t){var i=e.data("ref")||e.data("reference"),n=this.collection.findWhere({markerRef:i});m.a.trigger("ic:view",n,t)},clearSelection:function(){(new I).removeHighlight()},persistComment:function(e){this.$(".ic-current-selection").removeClass("ic-current-selection").addClass("inline-comment-marker").attr("data-ref",e.get("markerRef")),this.collection.add(e)},_addQuickReloadMarker:function(e,t,i){var n=t.comment;this.$('.inline-comment-marker[data-ref="'.concat(n.dataRef,'"],span[data-reference="').concat(n.dataRef,'"]')).length?i.resolve(t):(new I).deserializeHighlights(n.serializedHighlights,n.dataRef)?i.resolve(t):i.reject(t)}}),B=i("ERkP"),q=i.n(B),W=i("96U/"),X=(i("aWzz"),i("7nmT"),i("3iG9"));function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Q(){return(Q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function J(e,t){if(null==e)return{};var i,n,o=function(e,t){if(null==e)return{};var i,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)i=s[n],t.indexOf(i)>=0||(o[i]=e[i]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)i=s[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(o[i]=e[i])}return o}function K(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Y(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ee(e,t){return(ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var te=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Y(this,Z(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ee(e,t)}(t,B["Component"]),function(e,t,i){t&&K(e.prototype,t),i&&K(e,i)}(t,[{key:"renderUserLink",value:function(){var e=this.props,t=e.userId,i=J(e,["userId"]);return q.a.createElement("a",Q({},i,{"data-account-id":t}),this.props.children)}},{key:"render",value:function(){var e=this.props.userId;return q.a.createElement(X.a,{userId:e,isAnonymous:!e,canViewProfile:!0,position:"bottom right"},this.renderUserLink())}}]),t}();te.displayName="InlineCommentHeader";var ie=i("FErI");function ne(){return(ne=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function oe(e,t){if(null==e)return{};var i,n,o=function(e,t){if(null==e)return{};var i,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)i=s[n],t.indexOf(i)>=0||(o[i]=e[i]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)i=s[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(o[i]=e[i])}return o}var se=function(e){var t=Array.from(e.el.querySelectorAll(".ic-author")).filter(function(e){return null!==e.querySelector(".confluence-userlink")}).map(function(e){return e.querySelector(".confluence-userlink")});Object(ie.a)(t).forEach(function(e){var t=e.props,i=t["data-account-id"],n=oe(t,["data-account-id"]);Object(W.a)(q.a.createElement(te,ne({userId:i},n),e.props.children),e.placeholder)})},re=i("9Kiz");function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function le(e){return(le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function de(e,t){return(de=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ue(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var he=function(e){function t(){var e,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(ue(ue(i=function(e,t){return!t||"object"!==ae(t)&&"function"!=typeof t?ue(e):t}(this,(e=le(t)).call.apply(e,[this].concat(o))))),"state",{inlineCommentBodyNode:null}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&de(e,t)}(t,B["Component"]),function(e,t,i){t&&ce(e.prototype,t),i&&ce(e,i)}(t,[{key:"componentDidMount",value:function(){this._setInlineCommentBodyNode()}},{key:"_setInlineCommentBodyNode",value:function(){this.setState({inlineCommentBodyNode:this.props.node})}},{key:"render",value:function(){var e=this.props.body;return q.a.createElement(q.a.Fragment,null,q.a.createElement("p",{dangerouslySetInnerHTML:{__html:e}}),q.a.createElement(re.a,{node:this.state.inlineCommentBodyNode,position:"bottom right"}))}}]),t}();he.displayName="InlineCommentBody";var me=function(e){var t=e.el.querySelector(".ic-content");Object(W.a)(q.a.createElement(he,{node:t,body:t.innerHTML}),t)},fe=i("LodO");function pe(){r.a.Confluence.EditorLoader.resourcesLoaded()||this.$form.find(".loading-container").spin("small")}function ge(){r.a.Meta.set("content-type","comment"),r.a.Meta.set("use-inline-tasks","false"),r.a.Meta.set("min-editor-height",80)}function ve(e){e.$form.find(".loading-container").hide(),e.$form.find("#rte-button-publish").text(this.formatMessage({id:"inline.comments.sidebar.save"})).removeAttr("title"),e.$form.find("#toolbar-hints-draft-status").hide(),this.hideCancelButton&&e.$form.find("#rte-button-cancel").hide(),e.editor.onPostProcess.add(function(e,t){return function i(){l.a.tinymce.DOM.setStyle(l.a.tinymce.DOM.get("".concat(t.id,"_ifr")),"height","80px"),t.execCommand("mceAutoResize",{forceExec:!0}),t[e].remove(i)}}("onPostProcess",e.editor)),l.a.Confluence.Editor&&!l.a.Confluence.Editor.getContentType&&r.a.Confluence.QuickEdit.QuickEditPage.disable(),l.a.Confluence.Editor.removeAllCancelHandlers(),l.a.Confluence.Editor.removeAllSaveHandlers()}var ye,be,Ce,we={init:function(e){return this.formatMessage=e.formatMessage,r.a.Confluence.QuickEdit.activateEditor({preActivate:pe,preInitialise:ge,postInitialise:o.a.proxy(ve,e),toolbar:!1,$container:e.container,$form:e.form,saveHandler:e.saveHandler,cancelHandler:e.cancelHandler,fetchContent:e.fetchContent(),closeAnyExistingEditor:!0,postDeactivate:e.postDeactivate,plugins:x.getSupportedRtePlugins(),excludePlugins:x.getUnsupportedRtePlugins()})},remove:function(){return r.a.Rte&&r.a.Rte.getEditor()?r.a.Confluence.QuickEdit.deactivateEditor():o.a.Deferred().resolve()},getContent:function(){return r.a.Rte.Content.getHtml()},setEditorBusy:function(e){e?o()(".ic-sidebar #rte-spinner").spin():o()(".ic-sidebar #rte-spinner").spinStop(),o()("#rte-button-publish").prop("disabled",e)}},ke=m.a.View.extend({tagName:"div",className:"ic-create-comment-view",events:{"click .ic-action-save":"saveComment","click .ic-action-discard":"discardComment","keyup .ic-textarea":"onInput","focus .ic-textarea":"onFocus","click #show-page-comment":"showPageComment"},template:F.createComment,initialize:function(e){this.formatMessage=e.formatMessage,this.selection=e.selection,this.type=e.type,this.onFinished=e.onFinished||function(){},this.commentText=e.commentText||"",this.stopFocus=e.stopFocus,this.serializedHighlights=e.serializedHighlights,"edit"!==e.type&&"reply"!==e.type||(this.template=F.commentForm,m.a.trigger("ic:discard-edit"),this.listenTo(m.a,"ic:discard-edit",this.discardComment)),x.isSPAPage()?(this.isTinymceResourceReady="true"===o()(".".concat(x.getPageContentClassName())).attr("data-editor-resource-loaded"),this.isPendingRenderEditor=!1,this.listenTo(m.a,"ic:tinymce-resource-loaded",this.tinymceResourceLoaded)):this.isTinymceResourceReady=!0},tinymceResourceLoaded:function(){this.isTinymceResourceReady=!0,this.isPendingRenderEditor&&(this.isPendingRenderEditor=!1,this.renderEditor())},finish:function(){this.onFinished(),r.a.trigger("ic-jim-async-supported")},render:function(){var e=this._getAuthorObject(),t={type:this.type,text:this.commentText,showMenu:!1},i=u.a.extend({},e,t,{darkFeatures:x.getDarkFeatures()});return this.$el.html(this.template(i,this.formatMessage)),x.getDarkFeatures().RICH_TEXT_EDITOR?this.isTinymceResourceReady?this.renderEditor():(this.$(".loading-container").spin("small"),this.isPendingRenderEditor=!0):this.stopFocus||setTimeout(u.a.bind(this.focusEditor,this),1),"true"===this.options.isUnifiedProfileCardsEnabled&&se(this),x.addSidebarHeadingTooltip(this),this},onInput:function(e){var t=""!==this.$(e.target).val().trim();this._saveDisable(!t)},onFocus:function(){if("edit"===this.type){var e=this.$(".textarea");x.moveCaretToEnd(e[0]),this._saveDisable(""===e.text())}},saveComment:function(e){e.preventDefault(),this._isValid()&&(this._disableForm(),"reply"===this.type?this._addReply():"edit"===this.type?this._saveEdit():this._addComment())},_getAuthorObject:function(){var e,t,i;return"edit"===this.type?(e=this.model.get("authorUserName"),t=this.model.get("authorAvatarUrl"),i=this.model.get("authorDisplayName")):(e=r.a.Meta.get("remote-user"),t=x.getAuthorAvatarUrl(),i=x.getAuthorDisplayName()),{authorUserName:e,authorAvatarUrl:t,authorDisplayName:i}},_saveEdit:function(){var e=this._getContent(),t={wait:!0,beforeSend:u.a.bind(this.beforeSendAjax,this),success:u.a.bind(this._onSaveSuccess,this),error:u.a.bind(this._showEditError,this)};this.model.save({body:e},t)},_showEditError:function(e,t){var i;this.showCaptchaError(t)||(i=401===t.status?this.formatMessage({id:"inline.comments.edit.permission"}):this.formatMessage({id:"inline.comments.server.edit.error"}),this._triggerError(i))},_triggerError:function(e,t){m.a.trigger("ic:error",e,t),this._disableForm(!1)},_addReply:function(){new O({body:this._getContent(),commentId:this.model.get("id"),hasDeletePermission:!!r.a.Meta.get("remote-user")||this.model.get("hasDeletePermission")}).save(null,{beforeSend:u.a.bind(this.beforeSendAjax,this),success:u.a.bind(this._onSaveSuccess,this),error:u.a.bind(function(e,t){this.showCaptchaError(t)||this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.save.reply"}))},this)})},_addComment:function(){var e=new R({originalSelection:this.selection.searchText.selectedText.replace(/\n/g,""),body:this._getContent(),matchIndex:this.selection.searchText.index,numMatches:this.selection.searchText.numMatches,serializedHighlights:this.serializedHighlights}),t={callback:this.bindPageReloadLink};e.save(null,{beforeSend:u.a.bind(this.beforeSendAjax,this),success:u.a.bind(this._onSaveSuccess,this),error:u.a.bind(function(e,i){this.showCaptchaError(i)||(409===i.status?this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.stale"},{0:"<a href='#' class='ic-reload-page'>",1:"</a>"}),t):412===i.status?(r.a.trigger("analytics",{name:"confluence.comment.inline.cannot.create"}),this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.create.comment"}))):this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.save.comment"})))},this)})},_isValid:function(){return"<p><br /></p>"!==o.a.trim(this._getContent())||(m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.sidebar.comment.empty"})),!1)},_onSaveSuccess:function(e){switch(this.type){case"topLevel":e.set("hasDeletePermission",!0),m.a.trigger("ic:persist",e),m.a.trigger("ic:view",e,void 0,{ignoreConfirmDialog:!0});break;case"reply":this.model.replies.push(e),m.a.trigger("ic:reply:persist",e),this.finish();break;case"edit":m.a.trigger("ic:edit"),this.finish()}this.trackAnalyticEvent(e,this.type)},_setEditorIsNotDirty:function(){r.a.Rte.getEditor()&&(r.a.Rte.getEditor().isNotDirty=1)},_disableForm:function(e){void 0===e&&(e=!0),this._saveDisable(e),x.getDarkFeatures().RICH_TEXT_EDITOR||this.$(".ic-action-discard,.ic-textarea").prop("disabled",e).attr("aria-disabled",e)},_saveDisable:function(e){x.getDarkFeatures().RICH_TEXT_EDITOR?(we.setEditorBusy(e),o()("#rte-button-cancel")[0].disabled=e):this.$(".ic-action-save").prop("disabled",e).attr("aria-disabled",e)},renderEditor:function(){var e=this.$(".ic-body"),t=this.commentText,i=r.a.Confluence.QuickEdit.QuickComment;return we.init({formatMessage:this.formatMessage,container:e,form:e.find("form.aui"),saveHandler:"pageComment"===this.type?i.createSaveHandler(u.a.bind(this._successCreatePageComment,this),i.saveCommentErrorHandler):u.a.bind(this.saveComment,this),cancelHandler:u.a.bind(this.discardComment,this),fetchContent:function(){var e=new o.a.Deferred;return e.resolve({editorContent:t}),e},postDeactivate:u.a.bind(function(){m.a.trigger("ic:clearError"),this.finish()},this),hideCancelButton:"topLevel"===this.type}).done(u.a.bind(this.renderEditorCompleted,this)).fail(u.a.bind(this.renderEditorFail,this))},showPageComment:function(e){var t=o()(e.target).data("comment-id"),i=o()("#comment-".concat(t));i.addClass("focused"),i.scrollToElement()},_successCreatePageComment:function(e){l.a.Confluence.CommentDisplayManager.addComment(x.getCurrentUserInfo(),e,!1,!1,!0),r.a.trigger("page.commentAddedOrUpdated",{commentId:e.id}),this._setEditorIsNotDirty(),x.getDarkFeatures().RICH_TEXT_EDITOR&&(this.keepSidebar=!0,we.remove()),this.$el.html(F.pageComment({commentId:e.id},this.formatMessage)),x.addSidebarHeadingTooltip(this)},renderEditorCompleted:function(){m.a.trigger("ic:clearError"),"topLevel"!==this.type&&"pageComment"!==this.type||(this.$("#rte-button-cancel").hide(),"pageComment"===this.type&&(m.a.trigger("ic:error",this.formatMessage({id:"page.comments.sidebar.warning"})),this.focusEditor())),this.captchaManager=new r.a.Confluence.QuickEditCaptchaManager(r.a.Confluence.EditorLoader.getEditorForm())},renderEditorFail:function(){var e={closeable:!0,callback:this.bindPageReloadLink};switch(this.type){case"pageComment":this._setEditorIsNotDirty();break;case"topLevel":this.$(".loading-container").hide(),this.$(".ic-create-comment").hide(),e.closeable=!1;break;case"edit":case"reply":this.finish()}m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.editor.timeout"},{0:"<a href='#' class='ic-reload-page'>",1:"</a>"}),e),m.a.trigger("ic:editor:load:fail")},bindPageReloadLink:function(){o()(".ic-error").off("click",".ic-reload-page").on("click",".ic-reload-page",function(){return l.a.location.reload(),!1})},discardComment:function(e){e&&e.preventDefault(),m.a.trigger("ic:clearError"),this.finish()},_getContent:function(){return x.getDarkFeatures().RICH_TEXT_EDITOR?we.getContent():this.$("textarea").val()},focusEditor:function(){if(x.getDarkFeatures().RICH_TEXT_EDITOR)if("pageComment"===this.type){var e=o()(r.a.Rte.getEditor()&&r.a.Rte.getEditor().getBody()).find("div")[0];r.a.Rte.getEditor().selection.select(e,1),r.a.Rte.getEditor().selection.collapse(1),e.focus()}else r.a.Rte.getEditor()&&r.a.Rte.getEditor().focus();else this.$(".ic-textarea:visible").focus()},destroy:function(){x.getDarkFeatures().RICH_TEXT_EDITOR&&we.remove(),this.remove()},beforeSendAjax:function(e){var t=this.captchaManager.getCaptchaData();t&&t.id&&(e.setRequestHeader("X-Atlassian-Captcha-Id",t.id),e.setRequestHeader("X-Atlassian-Captcha-Response",t.response))},showCaptchaError:function(e){return!(404!==e.status||!e.responseText||-1==e.responseText.search(/captcha/i))&&(this.captchaManager.refreshCaptcha(),this._triggerError(this.formatMessage({id:"captcha.response.failed"})),!0)},trackAnalyticEvent:function(e,t){var i,n,s;try{i=e.attributes.id.toString(),n=e.changed.active?null:e.attributes.commentId.toString(),s=o()(".view-page-body").get(0).dataset.spaceId}catch(e){}var a={containerType:"space",containerId:s,source:"viewPageScreen",objectType:"page",objectId:r.a.Meta.get("content-id"),action:"edit"===t?"updated":"created",actionSubject:"comment",actionSubjectId:i,attributes:{commentType:"inline",pageType:r.a.Meta.get("draft-type"),parentCommentId:n}};Object(fe.a)().then(function(e){e.sendTrackEvent(a)})}}),Ee=m.a.View.extend({tagName:"div",className:"ic-confirm-container",initialize:function(e){this.formatMessage=e.formatMessage,this.$menuEl=e.$menuEl,this.$bodyEl=e.$bodyEl,this.$menuEl.addClass("ic-action-menu-active"),this.render(),u.a.bindAll(this,"clickOutside"),this.$bodyEl.on("click",this.clickOutside)},events:{"click .ic-action-cancel-confirm":"cancel","click .ic-action-delete-confirm":"confirm"},template:F.confirmDialog,render:function(){return this.$el.html(this.template(this.model.toJSON(),this.formatMessage)),this},clickOutside:function(e){o.a.contains(this.el,e.target)||this.el===e.target||this.cancel()},cancel:function(){this.destroy()},confirm:function(){this.trigger("ic:confirm"),this.destroy()},destroy:function(){this.$bodyEl.off("click",this.clickOutside),this.$menuEl.removeClass("ic-action-menu-active"),this.remove()}}),Se={init:function(e){this.likesCache=u.a.clone(e)||{}},getLikes:function(e){return this.likesCache&&this.likesCache[e]?u.a.map(this.likesCache[e].likes,function(e){return{username:e.user.name}}):null},add:function(e,t){this.likesCache[e]||(this.likesCache[e]={likes:[]}),this.likesCache[e].likes.push({user:{name:t}})},remove:function(e,t){if(this.likesCache[e]&&this.likesCache[e].likes){var i=u.a.reject(this.likesCache[e].likes,function(e){return e.user.name===t});this.likesCache[e].likes=i}},isLikable:function(){return void 0!==this.likesCache}},Te=m.a.Model.extend({initialize:function(e){if(!e)throw new Error("Attributes is required");if(!e.username)throw new Error("username is a required attribute")}}),xe=m.a.Collection.extend({model:Te,url:function(){return"".concat(r.a.contextPath(),"/rest/likes/1.0/content/").concat(this.contentId,"/likes")},initialize:function(e,t){if(u.a.bindAll(this,"_handleSaveSuccess","_handleDestroySuccess"),t=t||{},this.formatMessage=t.formatMessage,void 0===t.contentId)throw new Error("content ID is required.");this.contentId=t.contentId,Se.getLikes(t.contentId)&&this.reset(Se.getLikes(t.contentId)),this.listenTo(m.a,"ic:likes-received",this.updateLikes),this.bind("add",function(e){e.save(null,{success:this._handleSaveSuccess,error:this._handleError})}),this.bind("remove",function(e){e.id="",e.destroy({success:this._handleDestroySuccess,error:this._handleError})}),this.currentUserName=r.a.Meta.get("remote-user")},updateLikes:function(){this.reset(Se.getLikes(this.contentId))},addUser:function(e){return this.add({username:e})},removeUser:function(e){return this.remove(this.getUserByName(e))},isLikedByUser:function(e){return!!this.getUserByName(e)},getUserByName:function(e){return this.findWhere({username:e})},toggleLike:function(){this.isLikedByUser(this.currentUserName)?this.removeUser(this.currentUserName):this.addUser(this.currentUserName)},_handleSaveSuccess:function(){Se.add(this.contentId,this.currentUserName)},_handleDestroySuccess:function(){Se.remove(this.contentId,this.currentUserName)},_handleError:function(){m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.likes.error"}))}}),Oe=i("1vxf"),Pe=m.a.View.extend({className:"ic-likes",events:{"click .ic-likes-count":function(e){l.a.Confluence.Likes.showLikeUsers&&l.a.Confluence.Likes.showLikeUsers.apply(e.currentTarget,[e])}},initialize:function(e){this.collection=new xe(null,{contentId:e.contentId}),this.listenTo(this.collection,"add remove reset",this.render)},render:function(){return this.el&&Object(W.a)(q.a.createElement(Oe.a,{contentId:"".concat(this.options.contentId),contentType:"comment",containerId:"".concat(this.options.containerId),containerType:this.options.containerType,isForInlineComment:!0}),this.el),this}}),Re=m.a.View.extend({tagName:"div",className:"ic-display-reply",template:F.renderReply,events:{"click .ic-action-edit-reply":"editReply","click .ic-action-delete-reply":"confirmDelete"},initialize:function(e){this.formatMessage=e.formatMessage,u.a.bindAll(this,"onEditCallback"),this.$el.attr("data-comment-id",this.model.get("id"))},_renderLikes:function(){var e=this,t=this.el&&this.el.querySelector(".ic-action-like-reply");this.options.shouldShowInlineCommentLikes?this.options.shouldShowInlineCommentLikes.then(function(i){i?(e.likesView&&e.likesView.remove(),e.likesView=new Pe({contentId:e.model.id,el:t}).render()):t&&t.remove()}):t&&t.remove()},render:function(){var e=u.a.extend(this.model.toJSON(),{resolved:this.options.resolved,darkFeatures:x.getDarkFeatures()}),t=this.template(e,this.formatMessage);return this.$el.html(t),this._renderLikes(),"true"===this.options.isUnifiedProfileCardsEnabled&&(se(this),me(this)),this},editReply:function(e){var t=this;x.confirmProcess(this.formatMessage)?x.getEditorFormat(this.model.get("id")).done(function(e){t.editView=new ke({model:t.model,type:"edit",selection:{},onFinished:t.onEditCallback,commentText:e,formatMessage:t.formatMessage,isUnifiedProfileCardsEnabled:t.options.isUnifiedProfileCardsEnabled}),t.$el.html(t.editView.$el),t.editView.render()}).fail(function(){m.a.trigger("ic:error",t.formatMessage({id:"inline.comments.server.error.edit.reply"}))}):e&&e.currentTarget.blur()},onEditCallback:function(){this.editView&&this.editView.destroy(),this.editView=null,this.render()},deleteFail:function(e,t){401===t.status?m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.delete.permission"})):m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.server.error"}))},confirmDelete:function(e){!0===l.a.confirm(this.formatMessage({id:"inline.comments.delete.reply.confirmation.message"}))&&this.deleteReply(e)},deleteReply:function(e){o()(e.target).attr("aria-disabled",!0).prop("disabled",!0),this.model.destroy({wait:!0,error:this.deleteFail,success:function(){m.a.trigger("ic:reply:delete")}})},destroy:function(){this.likesView&&this.likesView.remove(),this.editView&&this.editView.destroy(),this.remove()}}),Me=m.a.View.extend({tagName:"div",className:"ic-replies",events:{"click #ic-showmore-container":"forceShowAllReplies"},initialize:function(e){if(this.formatMessage=e.formatMessage,!e.commentModel)throw new Error("Inline Comment Model should be passed as a parameter when init ReplyListView","ReplyListView");this.replyViews=[],this.collection=e.commentModel.replies,this.source=e.source,this.listenTo(this.collection,"add remove",this.render),!0!==this.collection.isFetched&&(this.listenToOnce(this.collection,"sync",this.fetchComplete),this.collection.fetch({reset:!0,cache:!1})),this.expandReplies=!1,this.COMMENT_NUMBER_TO_COLLAPSE=4},fetchComplete:function(){this.collection.isFetched=!0,this.render(),x.resizeContentAfterLoadingImages(this.$el)},render:function(e){return!0!==this.collection.isFetched?this:e&&this.collection.last()===e?void this.appendReply(e):(this.cleanUpReplyViews(),this.$el.empty(),this.collection.length>this.COMMENT_NUMBER_TO_COLLAPSE&&!1===this.expandReplies&&"permalink"!==this.source&&this.options.commentModel&&!this.options.commentModel.isResolved()?this.renderCollapsibleReplies():this.renderFullReplies(),this.trigger("ic:reply-rendered",this.options.commentModel),this._hightlightReply(),r.a.trigger("ic-jim-async-supported"),this)},renderFullReplies:function(){this.collection.each(function(e){this.appendReply(e)},this)},forceShowAllReplies:function(){this.expandReplies=!0,this.render()},renderCollapsibleReplies:function(){this.renderExpendButton();var e=this.collection.last();this.appendReply(e)},appendReply:function(e){var t=this.createReplyView(e);this.replyViews.push(t),this.$el.append(t.render().el)},renderExpendButton:function(){this.$el.append(F.showmoreReply({totalReplies:this.collection.length-1},this.formatMessage))},createReplyView:function(e){return new Re({formatMessage:this.formatMessage,model:e,resolved:this.options.commentModel.isResolved(),shouldShowInlineCommentLikes:this.options.shouldShowInlineCommentLikes,isUnifiedProfileCardsEnabled:this.options.isUnifiedProfileCardsEnabled})},_hightlightReply:function(){if("permalink"===this.source){var e=l.a.location.search.match(/(focusedCommentId|replyToComment)=(\d+)/);if(null!=e){var t=parseInt(e[2],10);t&&0!==t&&this.$("[data-comment-id=".concat(t,"]")).addClass("ic-comment-reply-highlight")}}},cleanUpReplyViews:function(){var e;for(e=0;e<this.replyViews.length;e++)this.replyViews[e].destroy(),this.replyViews[e]=null;this.replyViews=[]},destroy:function(){this.cleanUpReplyViews(),this.remove()}}),_e=m.a.View.extend({tagName:"div",events:{"click #ic-nav-previous":"showPrevious","click #ic-nav-next":"showNext"},template:F.navigation,initialize:function(e){this.formatMessage=e.formatMessage,this.collection=this.model.collection,this.listenTo(this.collection,"change:resolveProperties",this.onResolveToggle),this.disabled=this.collection.getCommentsOnPageCount()<=1,this.listenTo(m.a,"ic:show-previous",this.showPrevious),this.listenTo(m.a,"ic:show-next",this.showNext)},render:function(){return this.$el.html(this.template({disabled:this.disabled,showIndex:!(this.model.isResolved()||this.model.get("deleted")),index:this.collection.getActiveIndexWithinPageComments()+1,size:this.collection.getCommentsOnPageCount()},this.formatMessage)),this},onResolveToggle:function(){this.disabled=this.collection.getCommentsOnPageCount()<=1,this.render()},showPrevious:function(){if(!this.disabled){var e=this.collection.getPrevCommentOnPage();null!=e&&m.a.trigger("ic:view",e,"nav")}},showNext:function(){if(!this.disabled){var e=this.collection.getNextCommentOnPage();null!=e&&m.a.trigger("ic:view",e,"nav")}}}),$e=m.a.View.extend({tagName:"div",className:"ic-display-comment-view",template:F.displayComment,events:{"click .ic-action-reply":"replyComment","click .ic-action-resolve":"resolveComment","click .ic-action-edit":"editComment","click #show-resolved-comments":"showResolvedDialogDiscovery","click .ic-reply-placeholder .textarea":"replyComment","focus .ic-reply-container .textarea":"onReplyPlaceholderFocus"},initialize:function(e){this.formatMessage=e.formatMessage,u.a.bindAll(this,"confirm","destroy","deleteFail","replyComment","resolveComment","editComment","renderCommentOnly"),this.model.set("active",!0),this.listenTo(this.model,"change:resolveProperties",this.render),this.listenTo(this.model,"remove",this.destroy),o()("body").on("click",".ic-action-delete a",this.confirm),o()("body").on("click",".ic-action-reply a",this.replyComment),o()("body").on("click",".ic-action-resolve a",this.resolveComment),o()("body").on("click",".ic-action-edit a",this.editComment),this.replyListView=new Me({formatMessage:this.formatMessage,commentModel:this.model,source:e.source,shouldShowInlineCommentLikes:this.options.shouldShowInlineCommentLikes,isUnifiedProfileCardsEnabled:this.options.isUnifiedProfileCardsEnabled})},render:function(){return this.$el.html(this.template(u.a.extend(this.model.toJSON(),{showMenu:!0,currentAuthorUserName:r.a.Meta.get("remote-user"),currentAuthorAvatarUrl:x.getAuthorAvatarUrl(),currentAuthorDisplayName:x.getAuthorDisplayName(),darkFeatures:x.getDarkFeatures()}),this.formatMessage)),this.model.isResolved()?this.$(".ic-comment-container").addClass("ic-resolved"):this.$(".ic-list").append(this.replyListView.render().el),this._renderNavigation(),this._renderLikes(),x.addSidebarHeadingTooltip(this),"true"===this.options.isUnifiedProfileCardsEnabled&&(se(this),me(this)),this},_renderNavigation:function(){this.navigationView&&this.navigationView.remove(),this.navigationView=new _e({model:this.model,formatMessage:this.formatMessage}),this.navigationView.render(),this.$("#ic-nav-container").html(this.navigationView.el)},_renderLikes:function(){var e=this,t=this.el&&this.el.querySelector(".ic-action-like");this.options.shouldShowInlineCommentLikes?this.options.shouldShowInlineCommentLikes.then(function(i){i?(e.likesView&&e.likesView.remove(),e.likesView=new Pe({contentId:e.model.id,containerId:e.model.get("containerId"),containerType:e.model.get("containerType"),el:t}).render()):t&&t.remove()}):t&&t.remove()},editComment:function(e){var t=this;(e.preventDefault(),this.editView)?this.editView.focusEditor():x.confirmProcess(this.formatMessage)&&x.getEditorFormat(this.model.get("id")).done(function(e){t.editView=new ke({model:t.model,type:"edit",selection:{},onFinished:t.renderCommentOnly,commentText:e,formatMessage:t.formatMessage,isUnifiedProfileCardsEnabled:t.options.isUnifiedProfileCardsEnabled}),t.$(".ic-display-comment").html(t.editView.$el),t.editView.render()}).fail(function(){m.a.trigger("ic:error",t.formatMessage({id:"inline.comments.server.error.edit.comment"}))})},renderCommentOnly:function(){this.editView&&this.editView.destroy(),this.editView=null;var e=u.a.extend(this.model.toJSON(),{darkFeatures:x.getDarkFeatures()});this.$(".ic-display-comment").html(o()(F.comment(e,this.formatMessage)).children()),this._renderLikes()},replyComment:function(e){e&&e.preventDefault(),this.createReplyView?this.createReplyView.focusEditor():x.confirmProcess(this.formatMessage)?(this.createReplyView=new ke({formatMessage:this.formatMessage,model:this.model,type:"reply",onFinished:u.a.bind(function(){this.createReplyView&&this.createReplyView.destroy(),this.createReplyView=null},this),isUnifiedProfileCardsEnabled:this.options.isUnifiedProfileCardsEnabled}),this.$(".ic-reply-container").prepend(this.createReplyView.$el),this.createReplyView.render()):e&&e.currentTarget.blur()},confirm:function(e){if(e.preventDefault(),this.model.replies.length>0)return m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.delete.with.reply"})),!1;var t=new Ee({formatMessage:this.formatMessage,model:new m.a.Model({label:this.formatMessage({id:"inline.comments.sidebar.delete"}),message:this.formatMessage({id:"inline.comments.delete.confirmation.message"})}),$menuEl:o()(".ic-action-menu"),$bodyEl:o()("body")});this.$(".ic-sidebar-heading").append(t.$el),this.listenTo(t,"ic:confirm",this.deleteComment)},deleteComment:function(){var e=this;this.model.destroy({wait:!0,success:function(){e.$el.html(F.deleteComment(e.formatMessage)),e.model.set("deleted",!0),e._renderNavigation(),x.removeInlineLinksDialog(e.model.highlights),x.addSidebarHeadingTooltip(e),m.a.trigger("ic:delete")},error:this.deleteFail})},deleteFail:function(e,t){401===t.status?m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.delete.permission"})):409===t.status?m.a.trigger("ic:error",t.responseText):m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.server.error"}))},destroy:function(e){o()("body").off("click",".ic-action-delete a",this.confirm),o()("body").off("click",".ic-action-reply a",this.replyComment),o()("body").off("click",".ic-action-resolve a",this.resolveComment),o()("body").off("click",".ic-action-edit a",this.editComment),this.createReplyView&&this.createReplyView.destroy(),this.editView&&this.editView.destroy(),this.replyListView.destroy(),this.navigationView&&this.navigationView.remove(),this.likesView&&this.likesView.remove(),!0!==e&&this.remove()},resolveComment:function(e){e&&e.preventDefault(),x.confirmProcess(this.formatMessage,!0)&&this.model.resolve(!0,{wait:!0,success:u.a.bind(this.onResolveComplete,this),error:this.onResolveFail})},onResolveComplete:function(){this.createReplyView&&this.createReplyView.destroy(),this.createReplyView=null,m.a.trigger("ic:resolved"),x.removeInlineLinksDialog(this.model.highlights)},onResolveFail:function(e,t){401===t.status?m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.resolve.permission"})):m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.server.error"}))},showResolvedDialogDiscovery:function(){m.a.trigger("ic:resolved:show:recovery")},onReplyPlaceholderFocus:function(e){x.getDarkFeatures().RICH_TEXT_EDITOR&&(-1!==navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&e.currentTarget.blur())}}),De=m.a.View.extend({tagName:"div",className:"ic-sidebar",events:{"click button.ic-action-hide":function(e){this.hide(e,!0),m.a.trigger("ic:sidebar:close")}},initialize:function(e){e=e||{};var t=this;this.shouldSqueeze=e.shouldSqueeze,this.formatMessage=e.formatMessage,this.listenTo(m.a,"ic:view ic:overlap",this.displayComment),this.listenTo(m.a,"ic:create",this.displayCreateComment),this.listenTo(m.a,"ic:error",this.displayError),this.listenTo(m.a,"ic:hide-sidebar",this.hide),this.listenTo(m.a,"ic:clearError",this.clearError),x.getDarkFeatures().RICH_TEXT_EDITOR?r.a.bind("rte-quick-edit-ready".concat(".ic-sidebar"),function(){var e=t.$el.find("#wysiwygTextarea_ifr");0!==e.length?(new MutationObserver(function(){e.resize()}).observe(e[0],{attributes:!0,attributeFilter:["style"]}),r.a.Rte.getEditor().getContent()||t._scrollToEditorView(e)):t.$el.is(":visible")||(t.$wikiContent.css("position","static"),f.destroy())}):r.a.bind("init.rte".concat(".ic-sidebar"),u.a.bind(this.hideInEditMode,this)),this.defaultNavOffset=130,this.defaultPermalinkedCommentOffset=100,this.$wikiContent=e.$wikiContent||o()("[data-inline-comments-target=true]").first(),this.sidebarObserver=new MutationObserver(u.a.bind(this.setSidebarYPos,this)),this.sidebarObserver.observe(this.el,{childList:!0,subtree:!0}),o()(l.a).on("resize".concat(".ic-sidebar"),u.a.debounce(u.a.bind(this.setSidebarYPos,this),100)),r.a.bind("sidebar.expanded sidebar.collapsed".concat(".ic-sidebar"),u.a.debounce(u.a.bind(this.setSidebarYPos,this),50)),o()("#confluence-ui .wrapper-space-view-page").length>0&&this.$el.addClass("ic-is-spa-view-page")},destroy:function(){r.a.unbind(".ic-sidebar"),o()(l.a).off(".ic-sidebar"),this.hide(),this.remove()},displayComment:function(e,t,i){var n=function(){var n=this;if(!e.highlight.is(":hidden")||(x.showHighlightContent(e.highlight),!e.highlight.is(":hidden"))){this.distanceToTop=this.previousHighlightOffset||this.defaultNavOffset,this._emptySidebar(!0),this.commentView=new $e({formatMessage:this.formatMessage,model:e,source:t,shouldShowInlineCommentLikes:this.options.shouldShowInlineCommentLikes,isUnifiedProfileCardsEnabled:this.options.isUnifiedProfileCardsEnabled}),this.show(!0);var o=e.highlight.offset().top-this.$wikiContent.offset().top;this.previousHighlightOffset=o;var s=this.commentView.render().$el;s.css("visibility","hidden"),"nav"===t?x.scrollToActiveHighlight(o,this.distanceToTop):"permalink"===t?x.scrollToActiveHighlight(o,this.defaultPermalinkedCommentOffset).done(function(){i&&i.isReplyComment&&n.commentView.replyComment()}):"quickreload"===t&&this._scrollToQuickReloadComment(e),this.$el.html(s),l.a.Confluence.Binder&&l.a.Confluence.Binder.userHover()}};void 0===i||!1===i.ignoreConfirmDialog?x.confirmProcess(this.formatMessage,!0)&&n.call(this):n.call(this),r.a.trigger("ic-jim-async-supported")},_scrollToQuickReloadComment:function(e){var t=o()(".qr-feedback:first"),i=this.defaultPermalinkedCommentOffset;t.length>0&&(i=t.height()+67);var n=e.highlight.position().top;x.scrollToActiveHighlight(n,i)},_scrollToEditorView:function(e){var t=o()("body, html"),i=this.$(".ic-display-comment-view").position().top,n=e.closest(".ic-create-comment-view").position().top+i;(t.height()<n||t.scrollTop()>n)&&t.animate({scrollTop:n},100)},displayCreateComment:function(e,t,i){var n=this.isOnUnsupportedMacro();this._emptySidebar(!0),this.createCommentView=new ke({formatMessage:this.formatMessage,collection:e,selection:t,type:n?"pageComment":"topLevel",isFocus:!1,stopFocus:!0,commentText:n?"<blockquote>".concat(o()("<div/>").text(t.text).html(),"</blockquote> <div/>"):"",onFinished:u.a.bind(function(){this.createCommentView.keepSidebar||this.isShowing&&this.hide()},this),serializedHighlights:i,isUnifiedProfileCardsEnabled:this.options.isUnifiedProfileCardsEnabled}),this.show(),this.createCommentView.$el.css("visibility","hidden"),this.$el.html(this.createCommentView.$el),this.createCommentView.render()},isOnUnsupportedMacro:function(){var e=o()(".ic-current-selection");return x.containUnsupportedMacro(e)||x.containInternalLink(e)||x.containUserMetion(e)},displayError:function(e,t){t=u.a.extend({closeable:!0},t),this.clearError(),r.a.messages.warning(".ic-error",{body:e,closeable:t.closeable}),t.callback&&t.callback()},clearError:function(){o()(".ic-error").empty()},show:function(e){this.isShowing||(this._toggleSidebar(e),this.isShowing=!0)},hideInEditMode:function(e){"comment"!==r.a.Meta.get("content-type")&&(this.sidebarObserver.disconnect(),this.hide(e))},hide:function(e,t){var i=this;if(e&&e.preventDefault(),x.confirmProcess(this.formatMessage,!0)){if(!this.isShowing)return;this._toggleSidebar(t).done(function(){f.destroy(),m.a.trigger("ic:sidebar-hidden"),i.isShowing=!1})}},_toggleSidebar:function(e){var t,i=o()(".inline-comment-marker.active:first, .ic-current-selection:first");i.length>0&&(t=x.getOffsetTopRelativeInWindowCoordinate(i));var n=o.a.Deferred(),s=n.promise();return this.isShowing?e&&x.isAnimationSupported()?s=x.animateSidebar(this,!1):(f.destroy(),this.$wikiContent.css("position","static"),this._emptySidebar(),n.resolve()):("true"===this.shouldSqueeze&&f.shrinkToShowSideBar(),e&&x.isAnimationSupported()?s=x.animateSidebar(this,!0):n.resolve(),this.$wikiContent.css("position","relative")),s.done(function(){x.scrollToCommentAfterToggleSideBar(t,i)}),s},_emptySidebar:function(e){this.commentView&&(this.commentView.model.unset&&this.commentView.model.unset("active"),this.commentView.destroy(),this.commentView=null),this.createCommentView&&(this.createCommentView.keepSidebar=e,this.createCommentView.destroy(),this.createCommentView=null)},setSidebarYPos:function(){if(this.isShowing){var e,t,i=this.$el.offset().top;if(null!=this.commentView)e=this.commentView.$el,t=this.commentView.model.highlight;else{if(null==this.createCommentView)return;e=this.createCommentView.$el,t=o()(".ic-current-selection")}if(t){var n=this.$(".ic-sidebar-heading").height();e.css({visibility:"visible",position:"absolute",top:"".concat(t.offset().top-i-n,"px")}),x.recalculateContentHeight(e)}}}}),Ne=m.a.View.extend({tagName:"div",className:"ic-display-comment-view",template:F.comment,events:{"click .ic-action-unresolve":"unresolveComment","click .ic-action-show-reply":"showReply"},initialize:function(e){this.formatMessage=e.formatMessage,u.a.bindAll(this,"onUnresolveComplete","destroy"),this.replyListView=new Me({formatMessage:this.formatMessage,commentModel:this.model}),this.listenTo(this.replyListView,"ic:reply-rendered",function(){this.renderNumberOfReplies()})},render:function(){var e=this.template(u.a.extend(this.model.toJSON(),{showMenu:!1,isDangling:this.model.isDangling(),darkFeatures:x.getDarkFeatures(),hasReply:this.model.replies.length>0}),this.formatMessage);return this.$el.html(e),this.likesView&&this.likesView.remove(),this.likesView=new Pe({contentId:this.model.id,showLikeButton:!1}).render(),this.$(".ic-action-like").html(this.likesView.el),this.$el.append(this.replyListView.$el.hide()),this.replyListView.render(),this},unresolveComment:function(){m.a.trigger("ic:resolvedClearError"),this.model.resolve(!1,{wait:!0,success:this.onUnresolveComplete,error:this.onUnresolveFail})},onUnresolveComplete:function(){m.a.trigger("ic:unresolved"),this.$el.slideUp(this.destroy)},onUnresolveFail:function(e,t){401===t.status?m.a.trigger("ic:resolvedError",this.formatMessage({id:"inline.comments.resolve.permission"})):m.a.trigger("ic:resolvedError",this.formatMessage({id:"inline.comments.server.error"}))},showReply:function(){this.$(".ic-action-show-reply").parent().remove(),this.$(".ic-replies").slideDown()},renderNumberOfReplies:function(){var e,t=this.model.replies.length,i=this.$(".ic-action-show-reply");t>0?(e=1===t?this.formatMessage({id:"inline.comments.resolved.menu.show.reply"},{0:t}):this.formatMessage({id:"inline.comments.resolved.menu.show.replies"},{0:t}),i.text(e),i.parent().removeClass("hidden")):i.parent().remove()},destroy:function(){this.replyListView.destroy(),this.remove()}}),Ie=m.a.View.extend({events:{"click #resolved-dialog-close-button":"destroy"},template:F.resolvedCommentDialog,initialize:function(e){this.formatMessage=e.formatMessage,u.a.bindAll(this,"render","destroy","_onKeyDown"),this._resolvedCommentViews=[],this.listenTo(this.collection,"change:resolveProperties",this.onResolvedChanged),this.listenTo(m.a,"ic:resolvedError",this.displayError),this.listenTo(m.a,"ic:resolvedClearError",this.clearErrors);var t=o()(this.template(null,this.formatMessage));this.setElement(t),this.dialog=r.a.dialog2(this.$el),o()(l.a.document).bind("keydown",this._onKeyDown),r.a.trigger("remove-bindings.keyboardshortcuts")},render:function(){var e=o()("<div>"),t=this.collection.getResolvedCount();return 0!==t?u.a.each(this.collection.getResolvedCommentsDesc(),function(t){var i=new Ne({formatMessage:this.formatMessage,model:t});this._resolvedCommentViews.push(i),e.append(i.render().$el)},this):this.displayNoCommentMessage(),this.$(".aui-dialog2-content").append(e),this.dialog.show(),this.options.focusCommentId&&this.scrollToComment(this.options.focusCommentId),m.a.trigger("ic:resolved:view",t),r.a.trigger("ic-jim-async-supported"),this},onResolvedChanged:function(){0===this.collection.getResolvedCount()&&this.displayNoCommentMessage()},displayNoCommentMessage:function(){r.a.messages.generic(this.$(".aui-dialog2-content"),{body:this.formatMessage({id:"inline.comments.resolved.dialog.empty"}),closeable:!1})},displayError:function(e){this.clearErrors(),r.a.messages.warning(this.$("#ic-resolved-comment-dialog-error"),{body:e})},clearErrors:function(){this.$("#ic-resolved-comment-dialog-error").empty()},scrollToComment:function(e){var t=this.$(r.a.format("[data-comment-id={0}]",e));return t.length?(t.addClass("focused"),this.$(".aui-dialog2-content").animate({scrollTop:t.parent().position().top},100)):(new o.a.Deferred).reject()},_onKeyDown:function(e){this.$el&&this.$el.is(":visible")&&e.keyCode===r.a.keyCode.ESCAPE&&this.destroy()},destroy:function(){r.a.trigger("add-bindings.keyboardshortcuts"),o()(l.a.document).unbind("keydown",this._onKeyDown),this.dialog.hide(),this.dialog.remove(),u.a.each(this._resolvedCommentViews,function(e){e.destroy()}),this._resolvedCommentViews=null,this.remove()}}),He=m.a.Model.extend({}),Ae=m.a.Collection.extend({model:He,url:"".concat(r.a.contextPath(),"/rest/experimental/webfragment/panels?location=atl.page.content.footer.actions")}),Le=null,Ve={init:function(e,t){ye=t,Le=e.commentCollection;var i=new Promise(function(t){x.getDarkFeatures().LIKES_ADMIN_TOGGLE?(e.webPanelCollection||(e.webPanelCollection=new Ae),e.webPanelCollection.fetch({cache:!1}).done(function(e){t(e.length>0)})):t(!0)});e.views.sidebar&&e.views.sidebar.destroy(),e.views.sidebar=new De({formatMessage:ye,$wikiContent:o()("[data-inline-comments-target=true]").first(),shouldShowInlineCommentLikes:i,shouldSqueeze:e.shouldSqueeze,isUnifiedProfileCardsEnabled:e.isUnifiedProfileCardsEnabled}),f.$el.append(e.views.sidebar.$el),e.views.highlight&&e.views.highlight.destroy(),e.views.highlight=new z({collection:Le}),e.views.highlight.render(),l.a.Confluence&&l.a.Confluence.Likes&&l.a.Confluence.Likes.getLikesCache&&l.a.Confluence.Likes.getLikesCache().done(function(e){Se.init(e),m.a.trigger("ic:likes-received")})},loadSidebarOnClick:function(e){if(x.confirmProcess(ye)){m.a.trigger("ic:highlight-panel-click"),o()(".inline-comment-marker,span[data-mark-type=confluenceInlineComment]").removeClass("active");var t=x.overlappedSelection(e,Le);if(t){var i=o()('.inline-comment-marker[data-ref="'.concat(t.get("markerRef"),'"],span[data-reference="').concat(t.get("markerRef"),'"]'));l.a.Confluence.HighlightAction.clearTextSelection(),t.highlight=i,m.a.trigger("ic:overlap",t)}else{var n=(new I).removeHighlight().highlight(e.range);m.a.trigger("ic:create",Le,e,n)}}},updateResolvedCommentCountInToolsMenu:function(){o()("#view-resolved-comments>span").text(ye({id:"inline.comments.resolved.view.menu"})+r.a.format(" ({0})",Le.getResolvedCount()))},afterSyncCommentCollection:function(){var e=this;Le.once("sync",function(t){e.displayPermalinkedComment(t)}),Le.on("change:resolveProperties",function(){e.updateResolvedCommentCountInToolsMenu()}),this.updateResolvedCommentCountInToolsMenu()},displayPermalinkedComment:function(e){var t=l.a.location.search;x.showFocusedComment(e,t,Ie,ye)},createResolvedCommentListView:function(){new Ie({formatMessage:ye,collection:Le}).render()}},Ue=function(e){return Ve.init(e,Ce),Ve};function je(){return Fe.firstCaller&&(Fe.firstCaller=!1,be&&be.isResolved()?Ue(Fe):(be=o.a.Deferred()).resolve(Ue(Fe))),Fe.isSidebarLoaded=!1,be.promise()}var Fe={firstCaller:!0,isSidebarLoaded:!1,commentCollection:null,webPanelCollection:null,shouldSqueeze:!1,views:{sidebar:null},init:function(e){e=e||{},Fe.firstCaller=!0,Fe.isSidebarLoaded=!1,Fe.shouldSqueeze=e.shouldSqueeze,Fe.isUnifiedProfileCardsEnabled=e.isUnifiedProfileCardsEnabled,Fe.commentCollection||(Fe.commentCollection=new M),Fe.commentCollection.reset(),f.setPageContentElByCSSSelector(e.pageContentCSSSelector),f.setPageHeaderElByCSSSelector(e.pageHeaderCSSSelector),Fe.bindDOMEvents(),Fe.fetch(),Fe.bindQuickReloadEvents(),Fe.bindAppEvents(),Fe.focusOnComment(),Fe.updateResolvedCount(),r.a.bind("ic.force-refetch",Fe.fetch)},initAsync:function(){je().done(function(e){e.afterSyncCommentCollection(),e.displayPermalinkedComment(Fe.commentCollection)})},destroy:function(){r.a.unbind(".ic-app"),f.destroy()},bindDOMEvents:function(){o()("body").off("click".concat(".ic-app"),"#view-resolved-comments").on("click".concat(".ic-app"),"#view-resolved-comments",function(e){e.preventDefault(),je().done(function(e){e.createResolvedCommentListView()})})},bindAppEvents:function(){var e="ic:resolved.".concat(".ic-app");m.a.listenTo(m.a,e,function(){Fe.initAsync()})},fetch:function(){return Fe.commentCollection.fetch({cache:!1}).done(function(){Fe.commentCollection.getCommentsOnPageCount()>0&&Fe.initAsync(),Fe.commentCollection.getResolvedCount()>0&&je().done(function(e){e.updateResolvedCommentCountInToolsMenu()}),r.a.trigger("ic-fetch-completed",Fe.commentCollection)})},focusOnComment:function(){-1!==l.a.location.search.indexOf("focusedCommentId")&&Fe.initAsync()},bindQuickReloadEvents:function(){r.a.unbind("qr:show-new-thread".concat(".ic-app")).bind("qr:show-new-thread".concat(".ic-app"),function(e,t){je().done(function(){!function(e,t){var i=Fe.commentCollection.get(t),n=!1;void 0===i&&(i=new R({id:t}),n=!0),i.fetch({success:function(e){e._setHighlights(e.get("markerRef")),n?Fe.commentCollection.add(e):i.replies.isFetched=!1,m.a.trigger("ic:view",i,"quickreload")}})}(0,t)})}),r.a.unbind("qr:add-new-highlight".concat(".ic-app")).bind("qr:add-new-highlight",function(e,t,i){je().done(function(){r.a.trigger("qr:add-new-highlight-text",[t,i])})})},updateResolvedCount:function(){o()("#view-resolved-comments>span").text(Ce({id:"inline.comments.resolved.view.menu"})+r.a.format(" ({0})",Fe.commentCollection.getResolvedCount()))}};function ze(){o()(".tipsy").remove()}var Be={init:function(e){Ce=e.formatMessage,$.start(),ze(),Fe.init(e),l.a.Confluence&&l.a.Confluence.HighlightAction&&l.a.Confluence.HighlightAction.registerButtonHandler("com.atlassian.confluence.plugins.confluence-inline-comments:create-inline-comment",{onClick:function(e){je().done(function(t){Fe.isSidebarLoaded||(Fe.isSidebarLoaded=!0,t.loadSidebarOnClick(e))})},shouldDisplay:l.a.Confluence.HighlightAction.WORKING_AREA.MAINCONTENT_ONLY})},destroy:function(){ze(),Fe.destroy()},notifyEditor:function(){m.a.trigger("ic:tinymce-resource-loaded")}},qe=Object(a.d)("skate");if(!x.isSPAPage()){var We=r.a.Meta.get("page-id"),Xe=r.a.Meta.get("latest-page-id");We&&We===Xe&&o()(Be.init)}t.default=function(e){(function(e){return!(!__skate||!__skate.registry)&&void 0!==__skate.registry[e]})(x.getPageContentClassName())||qe(x.getPageContentClassName(),{type:qe.types.CLASS,attributes:{"data-content-id":{updated:function(e){this._init(e)}},"data-editor-resource-loaded":{updated:function(){Be.notifyEditor()}}},attached:function(e){this._init(e)},detached:function(){Be.destroy()},_init:function(t){var i=t.getAttribute("data-page-content-css-selector"),n=t.getAttribute("data-page-header-css-selector"),o=t.getAttribute("data-content-id"),s=t.getAttribute("data-should-squeeze"),r=t.getAttribute("data-unified-profile-cards");Be.init({formatMessage:e,pageContentCSSSelector:i,pageHeaderCSSSelector:n,contentId:o,shouldSqueeze:s,isUnifiedProfileCardsEnabled:r})}})}},wS3D:function(e,t){
/**
 * @license jQuery Text Highlighter
 * Copyright (C) 2011 - 2013 by mirz
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
!function(e,t,i,n){var o={ELEMENT_NODE:1,TEXT_NODE:3},s={name:"textHighlighter"};function r(t,i){this.context=t,this.$context=e(t),this.options=e.extend({},e[s.name].defaults,i),this.init()}r.prototype={init:function(){this.$context.addClass(this.options.contextClass),this.bindEvents()},destroy:function(){this.unbindEvents(),this.$context.removeClass(this.options.contextClass),this.$context.removeData(s.name)},bindEvents:function(){},unbindEvents:function(){},highlightHandler:function(e){e.data.self.doHighlight()},doHighlight:function(t){var i=t||this.getCurrentRange();if(i&&!i.collapsed){var n=i.toString(),o="";if(1==this.options.onBeforeHighlight(i)){var s=e.textHighlighter.createWrapper(this.options),r=this.highlightRange(i,s);o=this.normalizeHighlights(r),this.options.onAfterHighlight(o,n)}return this.removeAllRanges(),o}},getCurrentRange:function(){var e,t=this.getCurrentSelection();return t.rangeCount>0&&(e=t.getRangeAt(0)),e},removeAllRanges:function(){this.getCurrentSelection().removeAllRanges()},getCurrentSelection:function(){var t,i=this.getCurrentWindow();return i.getSelection?t=i.getSelection():e("iframe").length?e("iframe",top.document).each(function(){if(this.contentWindow===i)return t=rangy.getIframeSelection(this),!1}):t=rangy.getSelection(),t},getCurrentWindow:function(){var e=this.getCurrentDocument();return e.defaultView?e.defaultView:e.parentWindow},getCurrentDocument:function(){return this.context.ownerDocument?this.context.ownerDocument:this.context},highlightRange:function(t,i){if(!t.collapsed){var n=["SCRIPT","STYLE","SELECT","BUTTON","OBJECT","APPLET"],s=t.startContainer,r=t.endContainer,a=t.commonAncestorContainer,c=!0;if(0==t.endOffset){for(;!r.previousSibling&&r.parentNode!=a;)r=r.parentNode;r=r.previousSibling}else r.nodeType==o.TEXT_NODE?t.endOffset<r.nodeValue.length&&r.splitText(t.endOffset):t.endOffset>0&&(r=r.childNodes.item(t.endOffset-1));s.nodeType==o.TEXT_NODE?t.startOffset==s.nodeValue.length?c=!1:t.startOffset>0&&r==(s=s.splitText(t.startOffset)).previousSibling&&(r=s):s=t.startOffset<s.childNodes.length?s.childNodes.item(t.startOffset):s.nextSibling;var l=!1,d=s,u=[];do{if(c&&d.nodeType==o.TEXT_NODE){if(/\S/.test(d.nodeValue)){var h=i.clone(!0).get(0),m=d.parentNode;if(e.contains(this.context,m)||m===this.context){var f=e(d).wrap(h).parent().get(0);u.push(f)}}c=!1}d!=r||r.hasChildNodes()&&c||(l=!0),-1!=e.inArray(d.tagName,n)&&(c=!1),c&&d.hasChildNodes()?d=d.firstChild:null!=d.nextSibling?(d=d.nextSibling,c=!0):(d=d.parentNode,c=!1)}while(!l);return u}},normalizeHighlights:function(t){return this.flattenNestedHighlights(t),this.mergeSiblingHighlights(t),e.map(t,function(e){return void 0!==e.parentElement?null!=e.parentElement?e:null:null!=e.parentNode?e:null})},flattenNestedHighlights:function(t){var n=this;e.each(t,function(o){var s=e(this),r=s.parent(),a=r.prev(),c=r.next();if(n.isHighlight(r))if(r.css("background-color")!=s.css("background-color"))n.isHighlight(a)&&!s.get(0).previousSibling&&a.css("background-color")!=r.css("background-color")&&a.css("background-color")==s.css("background-color")&&s.insertAfter(a),n.isHighlight(c)&&!s.get(0).nextSibling&&c.css("background-color")!=r.css("background-color")&&c.css("background-color")==s.css("background-color")&&s.insertBefore(c),r.is(":empty")&&r.remove();else{var l=i.createTextNode(r.text());r.empty(),r.append(l),e(t[o]).remove()}})},mergeSiblingHighlights:function(t){var i=this;function n(t,n){return!(!n||n.nodeType!=o.ELEMENT_NODE||e(t).css("background-color")!=e(n).css("background-color")||!e(n).hasClass(i.options.highlightedClass))}e.each(t,function(){var t=this.previousSibling,i=this.nextSibling;if(n(this,t)){var o=e(t).text()+e(this).text();e(this).text(o),e(t).remove()}if(n(this,i)){o=e(this).text()+e(i).text();e(this).text(o),e(i).remove()}})},setColor:function(e){this.options.color=e},getColor:function(){return this.options.color},removeHighlights:function(t){var i=void 0!==t?t:this.context,n=this;this.getAllHighlights(i,!0).each(function(){if(1==n.options.onRemoveHighlight(this))(function(t){e(t).contents().unwrap().get(0)})(this)})},getAllHighlights:function(t,i){var n=".".concat(this.options.highlightedClass),o=e(t).find(n);return 1==i&&e(t).hasClass(this.options.highlightedClass)&&(o=o.add(t)),o},isHighlight:function(e){return e.hasClass(this.options.highlightedClass)},serializeHighlights:function(t){var i=t||this.getAllHighlights(this.context),n=this.context,s=[];return i.each(function(t,i){var r=0,a=i.firstChild.length,c=function(t,i){var n=[];do{var o=e.inArray(t,t.parentNode.childNodes);n.unshift(o),t=t.parentNode}while(t!==i);return n}(i,n);e(i).clone().empty().get(0).outerHTML;i.previousSibling&&i.previousSibling.nodeType===o.TEXT_NODE&&(r=i.previousSibling.length),s.push([e(i).text(),c.join(":"),r,a])}),JSON.stringify(s)},deserializeHighlights:function(t,i){try{var n=JSON.parse(t)}catch(e){throw new Error("Can't parse serialized highlights: ".concat(e))}var s=[],r=this,a=!0;return e.each(n,function(t,n){try{!function(t){for(var n=t[0],a=t[1].split(":"),c=t[2],l=t[3],d=a.pop(),u=null,h=r.context;void 0!==(u=a.shift());)h=h.childNodes[u];h.childNodes[d-1]&&h.childNodes[d-1].nodeType===o.TEXT_NODE&&(d-=1);var m=h.childNodes[d].splitText(c);if(m.splitText(l),m.nextSibling&&""==m.nextSibling.nodeValue&&m.parentNode.removeChild(m.nextSibling),m.previousSibling&&""==m.previousSibling.nodeValue&&m.parentNode.removeChild(m.previousSibling),n!==m.nodeValue)throw new Error("Different text");var f=e(m).wrap(i).parent().get(0);s.push(f)}(n)}catch(e){return console&&console.warn&&console.warn("Can't deserialize ".concat(t,"-th descriptor. Cause: ").concat(e)),a=!1,!0}}),a&&s}},e.fn.getHighlighter=function(){return this.data(s.name)},e.fn[s.name]=function(t){return this.each(function(){e.data(this,s.name)||e.data(this,s.name,new r(this,t))})},e.textHighlighter={createWrapper:function(t){return e("<span></span>").css("backgroundColor",t.color).addClass(t.highlightedClass)},defaults:{color:"#ffff7b",highlightedClass:"highlighted",contextClass:"highlighter-context",onRemoveHighlight:function(){return!0},onBeforeHighlight:function(){return!0},onAfterHighlight:function(){}}}}(jQuery,window,document)}}]);
//# sourceMappingURL=inline-comments.f7f2bcd3fe5c777add9a-v35.js.map