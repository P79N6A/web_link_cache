"use strict";!function(t){function e(){this.atList={},this.atDOM={},this.atData={},this.viewHeight=screen.height>0&&(window.innerHeight||document.documentElement.clientHeight)>=screen.height?screen.height:window.innerHeight||document.documentElement.clientHeight,this._item=".at_item",this.curKey="default"}e.prototype={init:function(e){var a=this;a._item=e?e:a._item,t(window).bind("scroll",a.throttle(function(){a.check()},500))},check:function(){var e=(document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop,this),a=e.curKey,n=t(e._item);this.atDOM[a]=n,e.atList[a]=e.atList[a]||[];var i=[];t.array.each(n,function(n,o){var r=o.getAttribute("adType");i[r]?i[r].counter++:(i[r]=[],i[r].counter=0),e.atList[a][r]=e.atList[a][r]||[];var s="none"!=o.style.display&&o.getBoundingClientRect(),c=.01;e.atList[a][r]&&!e.atList[a][r][n]&&s&&s.top<=e.viewHeight-s.height*c&&s.top>0?(e.atList[a][r][n]=!0,e.trigger("atMonitor:in",{idx:i[r].counter,type:r,key:a})):e.atList[a][r]&&!e.atList[a][r][n]&&t(o).hasClass(".fixed")?e.atList[a][r][n]||(e.atList[a][r][n]=!0,e.trigger("atMonitor:in",{idx:i[r].counter,type:r,key:a})):e.atList[a][r]&&e.atList[a][r][n]&&s&&(s.top<0||s.top>e.viewHeight-s.height*c)&&(e.atList[a][r][n]=!1)})},receiver:function(){var t=this;t.on("atMonitor:in",function(e){window.console&&console.log("\u7b2c"+e.idx+"\u6761\uff0c\u7c7b\u578b"+e.type+"\u5e7f\u544a\u9732\u51fa"),t.postAction(e.idx,e.type,0)})},getData:function(t,e){var a=this,n=(a.curKey,t.replace(/.*l=([\d,]+)&.*/,"$1"));n=1===n.length?n:n.split(","),a.jsonp({url:t,callback:"cb",time:3e3,success:function(t){var a={};if(t.ads.length<n.length){a.result=t.result,a.ads=[];for(var i=0;i<n.length;i++)for(var o=0;o<t.ads.length;o++)if(n[i]==t.ads[o].location){a.ads.push(t.ads[o]);break}}else a=t;e&&e(a)},fail:function(t){window.console&&console.trace(t.message),e&&e()}})},makeAtData:function(t,e){var a=this,n=a.curKey;a.atData[n]=a.atData[n]||[],a.atData[n][t]=a.atData[n][t]||[];for(var i=0;i<e.length;i++)a.atData[n][t].push(e[i]);return a.atData},clearData:function(t){this.atData[t]=[]},jsonp:function(t){function e(t){var e=[];for(var a in t)e.push(encodeURI(a)+"="+encodeURI(t[a]));return e.join("&")}if(t=t||{},!t.url||!t.callback)throw new Error("\u53c2\u6570\u4e0d\u5408\u6cd5");var a=t.callbackName||("jsonp_"+Math.random()).replace(".",""),n=document.getElementsByTagName("head")[0],i="";t.data?(t.data[t.callback]=a,i+=e(t.data)):i+=t.callback+"="+a;var o=document.createElement("script");o.setAttribute("charset","UTF-8"),n.appendChild(o),window[a]=function(e){clearTimeout(o.timer),window[a]=null,t.success&&t.success(e)},o.src=t.url+(/\?/.test(t.url)?"&":"?")+i,t.time&&(o.timer=setTimeout(function(){window[a]=null,t.fail&&t.fail({message:"\u8d85\u65f6"})},t.time))},postAction:function(t,e,a){var n=this,i=n.curKey;if(n.atData[i]&&n.atData[i][e]&&n.atData[i][e].length>0&&n.atData[i][e][t]&&n.atData[i][e][t].monitor)for(var o=0;o<n.atData[i][e][t].monitor.length;o++)n.atData[i][e][t].monitor[o].action==a&&n.atData[i][e][t].monitor[o].url&&n.post(n.atData[i][e][t].monitor[o].url)},post:function(t){var e=document.getElementsByTagName("head")[0],t=t,a=document.createElement("script");a.src=t,e.appendChild(a),a.onerror=function(t){e.removeChild(a)},a.onload=function(t){e.removeChild(a)}},throttle:function(t,e){var a=0,n=null,e=e||250;return function(){var i=this,o=arguments,r=+new Date;a&&r<a+e?(clearTimeout(n),n=setTimeout(function(){a=r,t.apply(i,o)},e)):(a=r,t.apply(i,o))}},on:function(t,e){this.handles||(this.handles={}),this.handles[t]||(this.handles[t]=[]),this.handles[t].push(e)},trigger:function(t){if(this.handles[arguments[0]])for(var e=0;e<this.handles[arguments[0]].length;e++)this.handles[arguments[0]][e](arguments[1])}};window.AT=new e}(NE);
