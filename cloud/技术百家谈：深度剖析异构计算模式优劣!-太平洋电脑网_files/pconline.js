/*!  svn://js.3conline.com/pcauto/commom/js/login.1.1.js*/
(function(h,k){function l(b,a){return new i(b,a)}var j=/^#([\w-]+)$|^(\w+)$|^\.([\w-]+)$/,m=/\?/;String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};function i(e,r){if(!e){return this}var c;this.elements=[];if(typeof e==="string"){r=r?(r.ownerDocument?r:document):document;c=j.exec(e);if(c[1]){var f=r.getElementById(c[1]);if(f){this.elements.push(f)}}if(c[2]){var s=r.getElementsByTagName(c[2]);this.elements=s}if(c[3]){var e=c[3],g=new RegExp("\\b"+e+"\\b");var s=[];if(document.getElementsByClassName){s=r.getElementsByClassName(e)}else{var a=r.getElementsByTagName("*");for(var d=0,b=a.length;d<b;d++){if(g.test(a[d].className)){s.push(a[d])}}}this.elements=s}}else{this.elements.push(e)}this[0]=this.elements[0]}i.prototype={each:function(a){var c=this.elements;for(var b=0,d=c.length;b<d;b++){a.call(c[b],b,c[b])}return this},hide:function(){return this.each(function(){this.style.display="none"})},show:function(){return this.each(function(){this.style.display="block"})},addClass:function(a){return this.each(function(){var c=this.className,b=new RegExp("\\b"+a+"\\b","g");if(!b.test(c)){this.className=(c+" "+a).trim()}})},removeClass:function(a){return this.each(function(){var c=this.className,b=new RegExp(a+"\\b\\s?","g");c=c.replace(b,"");this.className=c.trim()})},bind:function(a,b){var c=a;if(!("on"+a in document.body)){if(a=="mouseenter"){c="mouseover"}if(a=="mouseleave"){c="mouseout"}}return this.each(function(){var d=this;b.eventHandler=function(f){var f=f||h.event;f.target=f.target||f.srcElement;if(a=="mouseenter"||a=="mouseleave"){if("on"+a in document.body){b.call(d,f)}else{var e=l.event.getRelatedTarget(f);if(e!=d&&!l.contains(d,e)){b.call(d,f)}}}else{b.call(d,f)}};if(this.addEventListener){this.addEventListener(c,b.eventHandler,false)}else{this.attachEvent("on"+c,b.eventHandler)}})},unbind:function(a,b){var c=a;if(!("on"+a in document.body)){if(a=="mouseenter"){c="mouseover"}if(a=="mouseleave"){c="mouseout"}}return this.each(function(){if(this.removeEventListener){this.removeEventListener(c,b.eventHandler,false)}else{this.detachEvent("on"+c,b.eventHandler)}})}};l.contains=document.compareDocumentPosition?function(a,b){return !!(a.compareDocumentPosition(b)&16)}:function(a,b){return a!==b&&(a.contains?a.contains(b):true)};l.event={getRelatedTarget:function(a,b){if(a.relatedTarget){return a.relatedTarget}else{if(a.type=="mouseover"){return a.fromElement}else{if(a.type=="mouseout"){return a.toElement}else{return null}}}}};l.getJSONP=function(d){var e=d.url,c=+new Date(),a=d.charset||"",b=d.jsonpCallback||"xm"+c+Math.floor(Math.random()*1000);e+=(m.test(e)?"&":"?")+(d.jsonp||"callback")+"="+b;h[b]=h[b]||function(f){arguments.callee.cacheData=f;setTimeout(function(){h[b]=k;try{delete h[b]}catch(g){}},5000)};l.getScript(e,function(){d.success(h[b].cacheData)},a)};l.getScript=function(c,a,b){var d=document.createElement("script");if(b){d.charset=b}d.src=c;d.onload=d.onreadystatechange=function(){if(!d.readyState||d.readyState=="loaded"||d.readyState=="complete"){d.onload=d.onreadystatechange=null;a()}};document.getElementsByTagName("head")[0].appendChild(d)};var n=false;l.isReady=false;l.readyList=[];l.ready=function(a){l.bindReady();if(l.isReady){a()}else{if(l.readyList){l.readyList.push(a)}}};l.bindReady=function(){if(n){return}n=true;if(document.readyState==="complete"){return a()}if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,false);a()},false);h.addEventListener("load",a,false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",arguments.callee);a()}});h.attachEvent("onload",a)}}function a(){if(!l.isReady){if(!document.body){return setTimeout(a,13)}l.isReady=true;var b=l.readyList,d=b.length;for(var c=0;c<b.length;c++){b[c]()}}}};h.xm=l})(window);(function(){function h(a,b,d){if(d===undefined){d=true}for(var c in b){if(d||!(c in a)){a[c]=b[c]}}}var f={path:"",domain:"",secure:false};function j(c,d,a){a=a||{};h(a,f,false);if(d===null){a.expires=-1}var q=a.expires,b=a.path,p=a.domain,r=a.secure;if(typeof q==="number"){var e=q;q=new Date();q.setDate(q.getDate()+e)}var o=[encodeURIComponent(c),"=",encodeURIComponent(d),q?"; expires="+q.toUTCString():"",b?"; path="+b:"",p?"; domain="+p:"",r?"; secure":""].join("");document.cookie=o;return o}function i(a){return(new RegExp("(?:^|;\\s*)"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=")).test(document.cookie)}function g(a){if(!a||!i(a)){return null}var b=document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1");return decodeURIComponent(b)}window.Cookie={set:j,get:g,has:i}})();(function(app){var __offHtml="";var __onHtml='<div id="Jnb-tit-user" class="nb-tit nb-menu nb-tit-user">    <a href="//my.pconline.com.cn/" target="_blank" id="Jnb-userLink" class="user-link">        <i class="nb-head"><img id="JuserHeadPic" width="20" height="20" alt="" src="//www1.pconline.com.cn/images/blank.gif" /></i>        <span id="JuserName"></span>    </a>    <i class="nb-arrow"></i>    <div class="nb-menulist nb-ml-user">        <div class="nb-menulist-inner">            <div class="nb-menuList-con">                <div  class="nb-user-info nb-picTxt clearfix">                    <a href="//my.pconline.com.cn/" target="_blank" class="nb-pt-pic" id="Jnb-userLink2"><img id="JuserHeadPic2" width="50" height="50" src="//www1.pconline.com.cn/images/blank.gif" alt="" /></a>                    <dl>                        <dt><a href="//my.pconline.com.cn/" target="_blank" id="Jnb-userLink3"></a></dt>                        <dd class="nb-user-actions"><a href="//my.pconline.com.cn/friend/follow.jsp" target="_blank" id="Jnb-attention" class="first">关注<span>0</span></a><a id="Jnb-fans" href="//my.pconline.com.cn/friend/fans.jsp" target="_blank">粉丝<span>0</span></a><a id="Jnb-posts" href="//my.pconline.com.cn/forum/topic.jsp" target="_blank">帖子<span>0</span></a></dd>                    </dl>                </div>                <ul class="nb-user-rk clearfix nb-memu-li">                    <li><a href="//my.pconline.com.cn/forum/topic.jsp" target="_blank" class="nb-ml-mybbs">                        <i class="nb-ml-ic"></i> 我的论坛 </a></li>                    <li><a id="JmyFav" href="//my.pconline.com.cn/forum/favorforum.jsp" target="_blank" class="nb-ml-mycollect">                        <i class="nb-ml-ic"></i>我的收藏 </a></li>                    <li><a href="//my.pconline.com.cn/friend/follow.jsp" target="_blank" class="nb-ml-myfriends">                        <i class="nb-ml-ic"></i> 我的好友</a></li>                    <li><a href="//my.pconline.com.cn/cmt/cmt.jsp" target="_blank" class="nb-ml-mycmt">                        <i class="nb-ml-ic"></i> 我的评论</a></li>                </ul>                               <div class="nb-user-tf">                   <a href="//my.pconline.com.cn/setting/profile.jsp" target="_blank">账号管理</a> | <a href="javascript:;" target="_self" onclick="ajaxLogin.exitLogin();return false">退出</a>                </div>            </div> <em class="nb-ml-arrow"></em>        </div>    </div></div><div class="nb-tit nb-menu nb-tit-message nb-tit-nomsg" id="Jnb-tit-message">    <a href="//my.pconline.com.cn/msg/notice.jsp" class="nb-msg-icon" target="_blank"><span style="background: url(//www1.pconline.com.cn/header/images/navibar.v2.png) no-repeat;position:absolute; top:8px; left:0; height: 12px; width:16px;overflow:hidden; line-height:999em; background-position: -85px -23px; padding:0;">消息</span><i id="JallMessage" class="nb-message-num nb-message-none"></i></a>     <div class="nb-menulist">        <div class="nb-menulist-inner">             <ul class="nb-menuList-con nb-memu-lit">                <li><a href="//my.pconline.com.cn/msg/notice.jsp" target="_blank" id="systemNoticeCount">                    查看系统通知<span class="nb-message-num nb-message-none"></span></a></li>                <li><a href="//my.pconline.com.cn/msg/inbox.jsp?pageNo=1" target="_blank"  id="messageCount">                    查看私信<span class="nb-message-num nb-message-none"></span></a></li>                <li><a href="//my.pconline.com.cn/forum/receivereply.jsp" target="_blank" id="forumReplyCount">                    论坛回复<span class="nb-message-num nb-message-none"></span></a></li>                <li><a href="//my.pconline.com.cn/cmt/cmt.jsp" target="_blank" id="commentReplyCount">                    文章评论<span class="nb-message-num nb-message-none"></span></a></li>            </ul><em class="nb-ml-arrow"></em>        </div>    </div></div>';queueHanler(app.queue,app);delete app.url;delete app.queue;function queueHanler(queue,context,args){for(var i=0,len=queue.length;i<len;i++){queue[i].call(app,args)}}function getLoginInfo(fn){var loginInfo={};loginInfo.state=false;loginInfo.cmu="";if(!!document.cookie.match(/(^|; )common_session_id=[^;]+/)){loginInfo.cmu=document.cookie.match(/(^|; )cmu=([^;]+)/)[2];loginInfo.state=true}return loginInfo}var loginInfo=getLoginInfo(),isLogin=loginInfo.state;function exitLogin(){var d=document.createElement("div");d.style.display="none";d.innerHTML='<iframe src="'+location.protocol+'//passport3.pconline.com.cn/passport3/passport/logout_b.jsp?return=' + window.location.href + '" id="cross_frm" name="cross_frm" onload=" window.location.reload();" width="0" height="0"></iframe>';xm("#ajaxLogon")[0].parentNode.appendChild(d)}var user={};function getUserData(callback){if(!getLoginInfo().state){return false}if(user.data){callback(user.data)}else{if(user.queue){user.queue.push(callback)}else{user.queue=[callback];xm.getJSONP({url:location.protocol+"//my.pconline.com.cn/intf/getLogedUser.jsp",jsonpCallback:"jsonp_getUserData",charset:"GBK",success:function(data){user.data=data;queueHanler(user.queue,app,data);delete user.queue}})}}}function getAttentionCount(callback){if(!isLogin){return false}getUserData(function(data){xm.getJSONP({url:location.protocol+"//my.pconline.com.cn/bip/intf/focus.jsp?act=getFocusNum&accountId="+data.id,jsonpCallback:"jsonp_getAttentionCount",charset:"GBK",success:function(data){callback(data)}})})}function getfansCount(callback){if(!isLogin){return false}getUserData(function(data){xm.getJSONP({url:location.protocol+"//my.pconline.com.cn/bip/intf/focus.jsp?act=getFocusByNum&accountId="+data.id,jsonpCallback:"jsonp_getfansCount",charset:"GBK",success:function(data){callback(data)}})})}function getPostsCount(callback){if(!isLogin){return false}getUserData(function(data){xm.getJSONP({url:location.protocol+"//bbs.pconline.com.cn/action/user/user_setting_json.jsp?uid="+data.id,jsonpCallback:"jsonp_getPostsCount",charset:"GBK",success:function(data){callback(data)}})})}function updateUser(){getUserData(function(data){var uid=data.id,nick;if(typeof data!="object"||data.nickName==loginInfo.cmu){nick=loginInfo.cmu}else{nick=data.nickName}ajaxLogin.getHeadPic(20,function(url){xm("#JuserHeadPic")[0].src=xm("#JuserHeadPic2")[0].src=url});xm("#Jnb-userLink")[0].href=xm("#Jnb-userLink2")[0].href=xm("#Jnb-userLink3")[0].href=location.protocol+"//my.pconline.com.cn/"+uid+"/";xm("#JuserName")[0].innerHTML=xm("#Jnb-userLink3")[0].innerHTML=nick;xm("#Jnb-tit-user").bind("mouseenter",function(){xm(this).addClass("nb-tit-hover");if(this.getAttribute("hasHover")){return}ajaxLogin.getHeadPic(50,function(url){xm("#JuserHeadPic2")[0].src=url});getAttentionCount(function(count){var link=xm("#Jnb-attention")[0];xm("span",link)[0].innerHTML=count});getfansCount(function(count){var link=xm("#Jnb-fans")[0];xm("span",link)[0].innerHTML=count});getPostsCount(function(data){var link=xm("#Jnb-posts")[0];xm("span",link)[0].innerHTML=data.postCount?data.postCount:"0"});var rArtUrl=/\/\d{7}\.html/;if(rArtUrl.test(location.href)){xm("#JmyFav")[0].href=location.protocol+"//my.pconline.com.cn/collection/myArticle.jsp"}this.setAttribute("hasHover",true)}).bind("mouseleave",function(){xm(this).removeClass("nb-tit-hover")})})}function updateLoginHtml(html,callback){if(html){xm("#ajaxLogon")[0].innerHTML=html}bindMouseenter();callback()}function bindMouseenter(){if(!document.getElementById("ajaxLogon")){return function(){}}var touch="ontouchstart" in window;if(touch){xm(".nb-menu",xm("#navibar")[0]).bind("touchstart",function(){var self=this;if(!this.hasTouch){this.hasTouch=true;slideDown.call(this)}else{this.hasTouch=false;setTimeout(function(){slideUp.call(self)},550)}})}else{xm(".nb-menu",xm("#navibar")[0]).bind("mouseenter",function(){slideDown.call(this)}).bind("mouseleave",function(){slideUp.call(this)})}}function slideDown(){xm(this).addClass("nb-tit-hover");var tpl=xm("script",this)[0];tpl&&tpl.type=="text/template"&&function(){tpl.parentNode.innerHTML=tpl.innerHTML}()}function slideUp(){xm(this).removeClass("nb-tit-hover")}var message={};function getMessage(callback){if(!isLogin){return false}if(message.data){var localData=getLocalMessage();var data=localData?localData:message.data;var lastUpdatedTime=parseInt(data.lastUpdated);if((+new Date()-lastUpdatedTime)>30000){message.data="";setLocalMessage(data)}callback(data)}else{if(message.queue){message.queue.push(callback)}else{message.queue=[callback];xm.getJSONP({url:location.protocol+"//bip.pconline.com.cn/intf/message.jsp?act=getNumToJson&siteId=1",jsonpCallback:"jsonp_getMessage",charset:"GBK",success:function(data){data=fillterData(data);data=deleteSessionIdMsg(data);setLocalMessage(data);message.data=data;queueHanler(message.queue,app,data);delete message.queue}})}}}function deleteSessionIdMsg(data){var localData=getLocalMessage();if(localData&&localData.sessionId){data[localData.sessionId]=0;delete data[data.sessionId]}return data}function fillterData(data){return{systemNoticeCount:data.systemNoticeCount,messageCount:data.messageCount,forumReplyCount:data.forumReplyCount,commentReplyCount:data.commentReplyCount}}function stringfy(obj){var arr=[];for(var x in obj){arr.push('"'+x+'":"'+obj[x]+'"')}return"{"+arr.toString()+"}"}var LOCALKEY="__PConlineMsg";function setLocalMessage(data){data.lastUpdated=+new Date();Cookie.set(LOCALKEY,stringfy(data),{expires:1,domain:"pconline.com.cn",path:"/"})}function getLocalMessage(){var data;data=eval("("+Cookie.get(LOCALKEY)+")");return data}function updateMessage(){getMessage(function(data){if(data.code==-1){return}if(getAllMessage(fillterData(data))){xm("#Jnb-tit-message").removeClass("nb-tit-nomsg")}else{xm("#Jnb-tit-message").addClass("nb-tit-nomsg")}setMessage(data)})}function setMessage(data){var total=0,curMessageUrl;for(var x in data){var item=xm("#"+x)[0],count=parseInt(data[x]);if(item){total+=count;setSubMessage(xm(".nb-message-num",item),count);clickSubMessage(item,data);!curMessageUrl&&count&&(curMessageUrl=item.href)}}var allMesageUrl=xm("#Jnb-tit-message")[0].getElementsByTagName("a")[0],defaultUrl=allMesageUrl.href;curMessageUrl?(allMesageUrl.href=curMessageUrl):(allMesageUrl.href=defaultUrl);var allMesage=xm("#JallMessage");setSubMessage(allMesage,total);allMessages=getAllMessage(data);if(!allMessages){return}}function clickSubMessage(item,data){item.onclick=function(){var id=this.id;data[id]=0;data.sessionId=id;setLocalMessage(data)}}function setSubMessage(o,n){if(!o[0]){return}if(n>0){if(n>99){n="99+"}o[0].innerHTML=n;o.removeClass("nb-message-none")}else{o.addClass("nb-message-none")}}function getAllMessage(o){var msgs=0;for(var k in o){msgs+=parseInt(o[k])}return msgs}function getHeadPic(size,callback){if(!isLogin){return false}getUserData(function(data){var id=""+data.id;var ret=[],i=0,l=id.length;while(i+2<=l){ret.push(id.slice(i,i+2));i+=2}if(i<l){ret.push(id.charAt(i))}var url=location.protocol+"//i7.3conline.com/images/upload/upc/face/"+ret.join("/")+"/"+id+"_"+size+"x"+size;callback(url)})}function getVisitedForums(callback){xm.getJSONP({url:location.protocol+"//itbbs.pconline.com.cn/intf/lastViewForums.do",jsonpCallback:"jsonp_getVisitedForums",charset:"GBK",success:function(data){callback(data)}})}function getFavForums(callback){if(!isLogin){return false}getUserData(function(data){xm.getJSONP({url:location.protocol+"//bbs.pconline.com.cn/intf/user/_favForums.jsp?userId="+data.id,jsonpCallback:"jsonp_getFavForums",charset:"GBK",success:function(data){callback(data)}})})}function updateBbs(){xm("#Jnb-tit-bbs").bind("mouseenter",function(){if(this.hasHover){return}ajaxLogin.getVisitedForums(function(list){if(list.status==0){updateVisited(list.data)}else{updateVisited([])}});function updateVisited(list){var s="",l=list.length,i=0;if(l===0){s='<li class="nb-ml-item">暂无记录</li>'}else{for(;i<l&&i<4;i++){s+='<li><a class="nb-ml-item" href="'+list[i].forumUrl+'" target="_blank" title="'+list[i].forumName+'">'+list[i].forumName+"</a></li>"}}xm("#Jnb-bbs-visit")[0].innerHTML=s}loginInfo.state&&ajaxLogin.getFavForums(function(data){if(data.error){return}var ls=data.list,i=0,l=ls.length,str="";if(l==0){str='<li class="nb-ml-item">暂无收藏</li>'}else{for(;i<l&&i<4;i++){str+='<li><a class="nb-ml-item" href="'+ls[i].url.replace("http:","https:")+'" target="_blank" title="'+ls[i].name+'">'+ls[i].name+"</a></li>"}}xm("#Jnb-bbs-favb")[0].style.display="block";xm("#Jnb-bbs-favl")[0].innerHTML=str});this.hasHover=true})}function setup(){if(isLogin){updateLoginHtml(__onHtml,function(){updateUser();setTimeout(function(){updateMessage();setTimeout(arguments.callee,3000)},1000)})}else{updateLoginHtml(__offHtml,function(){xm("#Jlogin-tit").bind("mouseenter",function(){if(!this.isHover){xm("a",this).each(function(){this.href=this.href+escape(location.href)});this.isHover=true}})})}updateBbs()}setup();app.checkLogin=getLoginInfo;app.exitLogin=exitLogin;app.getUserData=getUserData;app.updateUser=updateUser;app.getMessage=getMessage;app.updateMessage=updateMessage;app.getHeadPic=getHeadPic;app.getVisitedForums=getVisitedForums;app.getFavForums=getFavForums;app.updateBbs=updateBbs;app.setup=setup})(ajaxLogin||{});