<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>microHOWTO: Configure an Ethernet interface as a VLAN trunk (Debian)</title>
<link rel="stylesheet" href="microHOWTO%20%20Configure%20an%20Ethernet%20interface%20as%20a%20VLAN%20trunk%20(Debian)_files/microhowto.css" type="text/css">
<link rel="icon" href="http://www.microhowto.info/favicon.png" type="image/png">
<script src="microHOWTO%20%20Configure%20an%20Ethernet%20interface%20as%20a%20VLAN%20trunk%20(Debian)_files/osd.js"></script><script src="microHOWTO%20%20Configure%20an%20Ethernet%20interface%20as%20a%20VLAN%20trunk%20(Debian)_files/ca-pub-1056047781503747.js"></script><script src="microHOWTO%20%20Configure%20an%20Ethernet%20interface%20as%20a%20VLAN%20trunk%20(Debian)_files/show_ads_impl.js" id="google_shimpl"></script><script type="text/javascript" src="microHOWTO%20%20Configure%20an%20Ethernet%20interface%20as%20a%20VLAN%20trunk%20(Debian)_files/microhowto.js"></script><meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="preload" href="microHOWTO%20%20Configure%20an%20Ethernet%20interface%20as%20a%20VLAN%20trunk%20(Debian)_files/integrator.js" as="script"><script type="text/javascript" src="microHOWTO%20%20Configure%20an%20Ethernet%20interface%20as%20a%20VLAN%20trunk%20(Debian)_files/integrator.js"></script><link rel="preload" href="microHOWTO%20%20Configure%20an%20Ethernet%20interface%20as%20a%20VLAN%20trunk%20(Debian)_files/show_ads_impl.js" as="script"></head>
<body onload="on_load();">
<div id="outer-header">
<div id="header">
<div id="logo"><a href="http://www.microhowto.info/"><img src="microHOWTO%20%20Configure%20an%20Ethernet%20interface%20as%20a%20VLAN%20trunk%20(Debian)_files/microhowto.png" alt="microHOWTO"></a></div>
<div id="search">
<form action="http://www.google.com" id="cse-search-box"><div>
<input type="hidden" name="cx" value="partner-pub-1056047781503747:4299715711"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="48"><input type="submit" name="sa" value="Search">
</div></form>
<script type="text/javascript" src="microHOWTO%20%20Configure%20an%20Ethernet%20interface%20as%20a%20VLAN%20trunk%20(Debian)_files/brand"></script>
</div>
<div id="menu"><ul>
<li class="selected"><a href="http://www.microhowto.info/">About</a></li>
<li><a href="http://www.microhowto.info/howto/index.html">microHOWTOs</a></li>
<li><a href="http://www.microhowto.info/tutorials/index.html">Tutorials</a></li>
<li><a href="http://www.microhowto.info/troubleshooting/index.html">Troubleshooting</a></li>
<li><a href="http://www.microhowto.info/tools/index.html">Tools</a></li>
</ul></div>
</div>
<div style="clear: both"></div>
</div>
<div id="main">
<div id="panels">
<div id="topics" class="panel">
<h2>Topics</h2>
<ul class="topics">
<li><a href="http://www.microhowto.info/topic/system.html">System</a></li>
<li><a href="http://www.microhowto.info/topic/storage.html">Storage</a></li>
<li><a href="http://www.microhowto.info/topic/networking.html">Networking</a></li>
<li><a href="http://www.microhowto.info/topic/security.html">Security</a></li>
<li><a href="http://www.microhowto.info/topic/dns.html">DNS</a></li>
<li><a href="http://www.microhowto.info/topic/mail.html">Mail</a></li>
<li><a href="http://www.microhowto.info/topic/web.html">Web</a></li>
<li><a href="http://www.microhowto.info/topic/graphics.html">Graphics</a></li>
<li><a href="http://www.microhowto.info/topic/databases.html">Databases</a></li>
<li><a href="http://www.microhowto.info/topic/scm.html">SCM</a></li>
<li><a href="http://www.microhowto.info/topic/programming.html">Programming</a></li>
</ul>
</div>
<div id="adsense-panel" class="panel">
<script async="async" src="microHOWTO%20%20Configure%20an%20Ethernet%20interface%20as%20a%20VLAN%20trunk%20(Debian)_files/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:inline-block;width:160px;height:600px" data-ad-client="ca-pub-1056047781503747" data-ad-slot="3108541718" data-adsbygoogle-status="done"><ins id="aswift_0_expand" style="display:inline-table;border:none;height:600px;margin:0;padding:0;position:relative;visibility:visible;width:160px;background-color:transparent;"><ins id="aswift_0_anchor" style="display:block;border:none;height:600px;margin:0;padding:0;position:relative;visibility:visible;width:160px;background-color:transparent;"><iframe marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;border:0px;width:160px;height:600px;" width="160" height="600" frameborder="0"></iframe></ins></ins></ins><script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<div id="rating" class="panel">
<h2>Rate this page</h2>
<form method="post" action="/rating.cgi">
<ul>
<li><label><input type="radio" name="level" value="excellent">Excellent</label></li>
<li><label><input type="radio" name="level" value="good">Good</label></li>
<li><label><input type="radio" name="level" value="acceptable">Acceptable</label></li>
<li><label><input type="radio" name="level" value="poor">Poor</label></li>
<li><label><input type="radio" name="level" value="dreadful">Dreadful</label></li>
</ul>
<div style="text-align: center">
<button type="submit" name="action" value="rate">Rate</button><button type="submit" name="action" value="view">View</button>
</div>
<input type="hidden" name="title" value="Configure an Ethernet interface as a VLAN trunk (Debian)"><input type="hidden" name="urlpath" value="howto/configure_an_ethernet_interface_as_a_vlan_trunk_on_debian.html">
</form>
</div>
<div id="metadata" class="panel">
<div class="linkto"><form method="get" action="/link.cgi">
<input type="submit" name="submit" value="Link to this page"><input type="hidden" name="title" value="Configure an Ethernet interface as a VLAN trunk (Debian)"><input type="hidden" name="urlpath" value="howto/configure_an_ethernet_interface_as_a_vlan_trunk_on_debian.html">
</form></div>
<div class="flattr"><a href="http://flattr.com/thing/466131/microHOWTO" target="_blank"><img src="microHOWTO%20%20Configure%20an%20Ethernet%20interface%20as%20a%20VLAN%20trunk%20(Debian)_files/flattr-badge-large.png" alt="Flattr this" title="Flattr this" border="0"></a></div>
</div>
</div>
<div id="content">
<div id="adsense-banner">
<script async="async" src="microHOWTO%20%20Configure%20an%20Ethernet%20interface%20as%20a%20VLAN%20trunk%20(Debian)_files/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-1056047781503747" data-ad-slot="5933482117" data-adsbygoogle-status="done"><ins id="aswift_1_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent;"><ins id="aswift_1_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent;"><iframe marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_1" name="aswift_1" style="left:0;position:absolute;top:0;border:0px;width:728px;height:90px;" width="728" height="90" frameborder="0"></iframe></ins></ins></ins><script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<h1>Configure an Ethernet interface as a VLAN trunk (Debian)</h1>
<div class="toc"><table class="toc">
<tbody><tr><td><h2 class="toc">Content</h2></td></tr>
<tr><td><ul class="toc">
<li><a href="#idp6048">1&nbsp;Objective</a></li>
<li><a href="#idp7312">2&nbsp;Background</a></li>
<li><a href="#idp9168">3&nbsp;Scenario</a></li>
<li><a href="#idp11600">4&nbsp;Method</a></li>
<li><a href="#idp21616">5&nbsp;Testing</a></li>
<li>
<a href="#idp25696">6&nbsp;Errors</a><ul class="toc">
<li><a href="#idp26384">6.1&nbsp;The vconfig command was not found</a></li>
<li><a href="#idp30400">6.2&nbsp;Physical device does not exist</a></li>
<li><a href="#idp34048">6.3&nbsp;Could not open /proc/net/vlan/config</a></li>
</ul>
</li>
<li><a href="#idp50464">7&nbsp;Variations</a></li>
<li><a href="#idp53664">8&nbsp;See also</a></li>
</ul></td></tr>
</tbody></table></div>

<category name="vlan"></category>
<tag name="ethernet"></tag>
<tag name="vlan"></tag>
<tag name="802.1q"></tag>

<div class="infobox"><table>
<tbody><tr><td><h2>Specific to</h2></td></tr>

<tr><td>Debian-based distributions</td></tr>
</tbody></table></div>

<div class="infobox"><table>
<tbody><tr><td><h2>Tested on</h2></td></tr>

<tr><td>Debian (Etch, Lenny, Squeeze)</td></tr>
<tr><td>Ubuntu (Hardy, Intrepid, Jaunty, Karmic, Lucid, Maverick, Natty, Precise, Trusty)</td></tr>
</tbody></table></div>

<h2><a name="idp6048">Objective</a></h2>

<p>To configure an Ethernet interface as an IEEE 802.1Q VLAN trunk on a Debian-based distribution.</p>


<h2><a name="idp7312">Background</a></h2>

<p>See <a href="http://www.microhowto.info/howto/configure_an_ethernet_interface_as_a_vlan_trunk.html">Configure an Ethernet interface as a VLAN trunk</a>.</p>


<h2><a name="idp9168">Scenario</a></h2>

<p>Suppose that a host requires access to two VLANs, both carried by a trunk connected to physical interface <code>eth0</code>. The assigned IP addresses for the host are <code>192.168.2.1/24</code> on VLAN 2 and <code>192.168.3.1/24</code> on VLAN 3.</p>


<h2><a name="idp11600">Method</a></h2>

<p>First install the <code>vlan</code> package if it is not already present:</p>
<pre class="code">apt-get install vlan
</pre>
<p>This provides the command <code>vconfig</code>, which you will not need to invoke directly, but which is needed by <code>ifup</code> and <code>ifdown</code> when using VLANs.</p>
<p>Next, add an interface definition for each VLAN to <code>/etc/network/interfaces</code>. The VLAN interface names must follow one of the naming conventions supported by <code>vconfig</code>. The one used and recommended here is of the form <code>eth<em>x</em>.<em>y</em></code>, where <code>eth<em>x</em></code> is the physical interface name and <code><em>y</em></code> is the VLAN number.</p>
<p>Apart from the special form of the interface name, the definitions are identical to those used for physical Ethernet interfaces:</p>
<pre class="code">auto eth0.2
iface eth0.2 inet static
  address 192.168.2.1
  netmask 255.255.255.0

auto eth0.3
iface eth0.3 inet static
  address 192.168.3.1
  netmask 255.255.255.0
</pre>
<p>Finally, bring the interfaces up in the normal way using <code>ifup</code>:</p>
<pre class="code">ifup eth0.2
ifup eth0.3
</pre>


<h2><a name="idp21616">Testing</a></h2>

<p>After invoking <code>ifup</code> you should be able to inspect the new VLAN interfaces using the <code>ifconfig</code> command:</p>
<pre class="code">ifconfig eth0.2
</pre>
<p>which should give output of the form:</p>
<pre class="output">eth0.2    Link encap:Ethernet  HWaddr 00:00:00:00:00:00
          inet addr:192.168.2.1  Bcast:12.168.2.255  Mask:255.255.255.0
          UP BROADCAST MULTICAST  MTU:1500 Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)
</pre>


<h2><a name="idp25696">Errors</a></h2>

<h3><a name="idp26384">The vconfig command was not found</a></h3>

<p>An error of the form:</p>
<pre class="error">/etc/network/if-pre-up.d/vlan: line 15: vconfig: command not found
SIOCSIFADDR: No such device
vlan1: ERROR while getting interface flags: No such device
SIOCSIFNETMASK: No such device
vlan1: ERROR while getting interface flags: No such device
Failed to bring up vlan1.
</pre>
<p>indicates that the <code>vlan</code> package (which provides the <code>vconfig</code> command) has not been installed. Install it using the command:</p>
<pre class="code">apt-get install vlan
</pre>


<h3><a name="idp30400">Physical device does not exist</a></h3>

<p>An error of the form:</p>
<pre class="error">Set name-type for VLAN subsystem. Should be visible in /proc/net/vlan/config
Device "eth0" does not exist.
eth0 does not exist, unable to create vlan1
run-parts: /etc/network/if-pre-up.d/vlan exited with return code 1
SIOCSIFADDR: No such device
vlan1: ERROR while getting interface flags: No such device
SIOCSIFNETMASK: No such device
vlan1: ERROR while getting interface flags: No such device
Failed to bring up vlan1.
</pre>
<p>indicates that the physical Ethernet interface that would have hosted
 the VLAN could not be found. Check that the interface name is correctly
 specified in <code>/etc/network/interfaces</code>. Use the <code>ifconfig</code> command to check that the interface exists.</p>


<h3><a name="idp34048">Could not open /proc/net/vlan/config</a></h3>

<p>An error of the form:</p>
<pre class="error">WARNING:  Could not open /proc/net/vlan/config.  Maybe you need to load the 8021q module, or maybe you are not using PROCFS??
ERROR: trying to set name type for VLAN subsystem, error: Package not installed
WARNING:  Could not open /proc/net/vlan/config.  Maybe you need to load the 8021q module, or maybe you are not using PROCFS??
ERROR: trying to add VLAN #1 to IF -:eth0:-  error: Package not installed
SIOCSIFADDR: No such device
eth0.1: ERROR while getting interface flags: No such device
SIOCSIFNETMASK: No such device
eth0.1: ERROR while getting interface flags: No such device
Failed to bring up eth0.1.
</pre>
<p>could indicate (as the message suggests) either:</p>
<ol>
<li>that the 802.1Q kernel module has not been loaded, or</li>
<li>that <code>/proc</code> has not been mounted.</li>
</ol>
<p>The kernel module should load automatically when you invoke <code>ifup</code>. You can determine whether this has happened using the <code>lsmod</code> command, which lists the kernel modules that are currently loaded. You are looking for one called <code>8021q</code> (with no dot between <code>802</code> and <code>1q</code>):</p>
<pre class="code">lsmod | grep 8021q
</pre>
<p>If the module is not listed then the most likely explanation is that 
it could not be found. Confirm this by trying to manually load it using 
the command <code>modprobe</code>:</p>
<pre class="code">modprobe 8021q
</pre>
<p>This should give an error of the form:</p>
<pre class="error">FATAL: Could not open '/lib/modules/2.6.26-2-486/kernel/net/8021q/8021q.ko': No such file or directory
</pre>
<p>If the operating system you are running was originally installed using <code>debootstrap</code> or a similar mechanism then it is quite likely that no kernel modules have been installed yet, in which case <code>/lib/modules</code>
 will be empty. Provided you are running a normal stock kernel you can 
correct this by loading the appropriate modules package, for example:</p>
<pre class="code">apt-get install linux-image-2.6.26-2-486
</pre>
<p>If it is a normal installation then a possible explanation is that 
you are running a different kernel from the one that was originally 
installed but have not provided a matching set of kernel modules. If 
this is the case then there will be no directory in <code>/lib/modules</code> with a name that matches the running kernel version.</p>
<p>Alternatives are that the file in question has been deleted somehow, 
or you are running a custom kernel that does not include 802.1Q support.</p>
<p>The simplest way to check whether <code>/proc</code> has been mounted is to list the content of that directory. See <a href="http://www.microhowto.info/troubleshooting/mounting_proc.html">here</a> for further guidance.</p>



<h2><a name="idp50464">Variations</a></h2>

<p>You may encounter interface definitions in which the physical interface name is specified explicitly by means of a <code>vlan-raw-device</code> command. This is only needed when using a naming convention that does not incorporate the physical interface name, for example:</p>
<pre class="code">auto vlan2
iface vlan2 inet static
  address 192.168.2.1
  netmask 255.255.255.0
  vlan-raw-device eth0
</pre>
<p>Disadvantages of this approach are that there is more to go wrong, 
and it does not allow for multiple interfaces with the same VLAN number.</p>


<h2><a name="idp53664">See also</a></h2>

<ul>
<li><a href="http://www.microhowto.info/tutorials/802.1q.html">IEEE 802.1Q VLAN Tutorial</a></li>
<li><a href="http://www.microhowto.info/howto/configure_an_ethernet_interface_as_a_vlan_trunk_on_redhat.html">Configure an Ethernet interface as a VLAN trunk (Red Hat)</a></li>
</ul>

<div class="categories"><p class="categories">Tags:
<a href="http://www.microhowto.info/tags/802.1q.html">802.1q</a>&nbsp;|&nbsp;<a href="http://www.microhowto.info/tags/ethernet.html">ethernet</a>&nbsp;|&nbsp;<a href="http://www.microhowto.info/tags/vlan.html">vlan</a></p></div>
</div>
<div style="clear: both"></div>
</div>
<div id="outer-footer"><div id="footer">
<div id="copyright">
© 2010–2018 <a href="http://www.microhowto.info/authors/gdshaw.html" rel="author">Graham Shaw</a>, <a href="http://www.microhowto.info/legal.html">some rights</a> reserved.<a href="mailto:djones@codepolice.org"></a>
</div>
<ul>
<li><a href="http://www.microhowto.info/conventions.html">Conventions</a></li>
<li><a href="http://www.microhowto.info/privacy.html">Privacy</a></li>
<li><a href="http://www.microhowto.info/legal.html">Legal</a></li>
</ul>
</div></div>
<div id="cookies" style=""><form action="" method="GET"><p>Danger, Will Robinson: this website uses cookies. Read our <a href="http://www.microhowto.info/privacy.html">privacy policy</a> to learn more about your peril.
<input type="button" name="close" value="X" onclick="hide_cookie_message()"></p></form></div>


<iframe id="google_osd_static_frame_6864543137409" name="google_osd_static_frame" style="display: none; width: 0px; height: 0px;"></iframe></body><iframe id="google_esf" name="google_esf" src="microHOWTO%20%20Configure%20an%20Ethernet%20interface%20as%20a%20VLAN%20trunk%20(Debian)_files/zrt_lookup.html" style="display: none;" data-ad-client="ca-pub-1056047781503747"></iframe></html>